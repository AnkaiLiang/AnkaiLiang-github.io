<!DOCTYPE html>
<html lang="en">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Ankai Liang" />



<meta name="description" content="CS615 Assignment4">
<meta name="keywords" content="System Administration">
<meta property="og:type" content="article">
<meta property="og:title" content="Tcpdump(1) DNS">
<meta property="og:url" content="https://AnkaiLiang.github.io/2017/08/16/tcpdump-1-DNS/index.html">
<meta property="og:site_name" content="Ankai Liang&#39;s Blog">
<meta property="og:description" content="CS615 Assignment4">
<meta property="og:updated_time" content="2017-08-17T07:33:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tcpdump(1) DNS">
<meta name="twitter:description" content="CS615 Assignment4">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Ankai Liang&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/img/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Tcpdump(1) DNS | Ankai Liang&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Ankai Liang</a></h1>
        </hgroup>

        
        <p class="header-subtitle">强而不燥，弱而不虚</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>Menu</li>
                        <li>Tags</li>
                        
                        <li>Friends</li>
                        
                        
                        <li>About Me</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">Home</a></li>
                        
                            <li><a href="/archives/">All Article</a></li>
                        
                            <li><a href="/tags/">tags</a></li>
                        
                            <li><a href="/about/">Resume</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="/lakeandgod@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" href="http://weibo.com/1783077873/profile?rightmod=1&wvr=6&mod=personnumber" title="新浪微博"></a>
                            
                                <a class="fa GitHub" href="https://github.com/ankaiLiang" title="GitHub"></a>
                            
                                <a class="fa Facebook" href="https://www.facebook.com/lakeandgod" title="Facebook"></a>
                            
                                <a class="fa LinkedIn" href="https://www.linkedin.com/in/ankai-liang-a774b3119?trk=hp-identity-name" title="LinkedIn"></a>
                            
                                <a class="fa Instagram" href="https://www.instagram.com/ankai_liang/" title="Instagram"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/System-Administration/">System Administration</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="http://jayveehe.github.io">Jayvee He的博客</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://wangzi6147.github.io">wangzi的博客</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">true</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Ankai Liang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Ankai Liang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">强而不燥，弱而不虚</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">All Article</a></li>
                
                    <li><a href="/tags/">tags</a></li>
                
                    <li><a href="/about/">Resume</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="/lakeandgod@gmail.com" title="Email"></a>
                            
                                <a class="fa 新浪微博" target="_blank" href="http://weibo.com/1783077873/profile?rightmod=1&wvr=6&mod=personnumber" title="新浪微博"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/ankaiLiang" title="GitHub"></a>
                            
                                <a class="fa Facebook" target="_blank" href="https://www.facebook.com/lakeandgod" title="Facebook"></a>
                            
                                <a class="fa LinkedIn" target="_blank" href="https://www.linkedin.com/in/ankai-liang-a774b3119?trk=hp-identity-name" title="LinkedIn"></a>
                            
                                <a class="fa Instagram" target="_blank" href="https://www.instagram.com/ankai_liang/" title="Instagram"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="Tags" friends="Friends" about="About Me"/>
</nav>
      <div class="body-wrap"><article id="post-tcpdump-1-DNS" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/08/16/tcpdump-1-DNS/" class="article-date">
      <time datetime="2017-08-17T03:27:53.000Z" itemprop="datePublished">2017-08-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Tcpdump(1) DNS
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/System-Administration/">System Administration</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <a id="more"></a>
<h1 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h1><ul>
<li>link: <a href="http://www.cs.stevens.edu/~jschauma/615/s17-hw4.html" target="_blank" rel="external">http://www.cs.stevens.edu/~jschauma/615/s17-hw4.html</a></li>
</ul>
<h2 id="Objective"><a href="#Objective" class="headerlink" title="Objective"></a>Objective</h2><p>The objective of this assignment is for you to learn how to use tcpdump to observe and analyze network traffic. This reinforces lessons from our lecture on networking and prepares you for our lecture on the DNS.</p>
<p>In order to be able to observe DNS traffic flowing between your host and the DNS root servers as well as other DNS servers, you will need to set up and configure a simple caching name server, aka a resolver.</p>
<p>Note: you must use tcpdump. Graphical helper applications such as “wireshark” or similar tools are explicitly prohibited. You need to be able to read the flat text tcpdump output yourself and not rely on other tools to highlight things for you.</p>
<h2 id="OS-Instances"><a href="#OS-Instances" class="headerlink" title="OS Instances"></a>OS Instances</h2><p>The exercises below can be done on any OS instance you like. You will need at least two OS instances, one for the DNS server and one for the “client”. Make sure that the firewall rules between the server and client allow for all the required traffic.</p>
<h3 id="DNS-server-setup"><a href="#DNS-server-setup" class="headerlink" title="DNS server setup"></a>DNS server setup</h3><p>Set up a caching only DNS server (a ``resolver’’) on your OS instance. You may consult any online documentation available, such as this document or any others you prefer. You may use bind or any other DNS server software you like. The only restriction is that in the end your host must be able to function as a caching DNS server.</p>
<p>Set up your client host to use your newly created DNS server for host lookups.</p>
<p>tcpdump exercises</p>
<p>Use the tcpdump utility to monitor the network traffic using the following scenarios:</p>
<p>on the DNS server, run the following commands:<br>$ telnet www.yahoo.com 80<br>GET / HTTP/1.1<br>Host: www.yahoo.com</p>
<p>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.<br>Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</p>
<p>on your client host, run the following commands:<br>$ telnet www.tumblr.com 80<br>GET / HTTP/1.0</p>
<p>On your client: Track down the packets in your tcpdump referring to the DNS query from your client host to your DNS server.<br>On your DNS server: Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</p>
<p>on the DNS server, perform a reverse host lookup (PTR) for a record not yet in your DNS server’s cache; track down in your tcpdump all relevant DNS queries required to retrieve the result. Clearly identify which name servers you are communicating with and who operates them.</p>
<hr>
<h1 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h1><h2 id="Set-up-a-caching-name-server"><a href="#Set-up-a-caching-name-server" class="headerlink" title="Set up a caching name server"></a>Set up a caching name server</h2><p>I read some tutorials and decide to set uo my name server in Red Hats OS.<br>tutorals:<br><a href="http://www.tecmint.com/install-configure-cache-only-dns-server-in-rhel-centos-7/" target="_blank" rel="external">http://www.tecmint.com/install-configure-cache-only-dns-server-in-rhel-centos-7/</a><br><a href="http://www.tldp.org/HOWTO/DNS-HOWTO-3.html" target="_blank" rel="external">http://www.tldp.org/HOWTO/DNS-HOWTO-3.html</a></p>
<h2 id="Create-a-instance-of-Red-Hat"><a href="#Create-a-instance-of-Red-Hat" class="headerlink" title="Create a instance of Red Hat."></a>Create a instance of Red Hat.</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div></pre></td><td class="code"><pre><div class="line">➜  ~ git:(master) ✗ aws ec2 run-instances --image-id ami-b63769a1 --count 1 --instance-type t2.micro --key-name keypair3 --security-groups mysg</div><div class="line">&#123;</div><div class="line">    &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">    &quot;ReservationId&quot;: &quot;r-003997252666b66c6&quot;, </div><div class="line">    &quot;Groups&quot;: [], </div><div class="line">    &quot;Instances&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;Monitoring&quot;: &#123;</div><div class="line">                &quot;State&quot;: &quot;disabled&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;PublicDnsName&quot;: &quot;&quot;, </div><div class="line">            &quot;RootDeviceType&quot;: &quot;ebs&quot;, </div><div class="line">            &quot;State&quot;: &#123;</div><div class="line">                &quot;Code&quot;: 0, </div><div class="line">                &quot;Name&quot;: &quot;pending&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;EbsOptimized&quot;: false, </div><div class="line">            &quot;LaunchTime&quot;: &quot;2017-03-18T22:23:48.000Z&quot;, </div><div class="line">            &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;, </div><div class="line">            &quot;ProductCodes&quot;: [], </div><div class="line">            &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">            &quot;StateTransitionReason&quot;: &quot;&quot;, </div><div class="line">            &quot;InstanceId&quot;: &quot;i-0c7d5c4b3a4726bd7&quot;, </div><div class="line">            &quot;ImageId&quot;: &quot;ami-b63769a1&quot;, </div><div class="line">            &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">            &quot;KeyName&quot;: &quot;keypair3&quot;, </div><div class="line">            &quot;SecurityGroups&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                    &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                &#125;</div><div class="line">            ], </div><div class="line">            &quot;ClientToken&quot;: &quot;&quot;, </div><div class="line">            &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">            &quot;InstanceType&quot;: &quot;t2.micro&quot;, </div><div class="line">            &quot;NetworkInterfaces&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;Status&quot;: &quot;in-use&quot;, </div><div class="line">                    &quot;MacAddress&quot;: &quot;0e:db:b6:0f:70:54&quot;, </div><div class="line">                    &quot;SourceDestCheck&quot;: true, </div><div class="line">                    &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                    &quot;Description&quot;: &quot;&quot;, </div><div class="line">                    &quot;NetworkInterfaceId&quot;: &quot;eni-423bf184&quot;, </div><div class="line">                    &quot;PrivateIpAddresses&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">                            &quot;Primary&quot;: true, </div><div class="line">                            &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">                    &quot;Attachment&quot;: &#123;</div><div class="line">                        &quot;Status&quot;: &quot;attaching&quot;, </div><div class="line">                        &quot;DeviceIndex&quot;: 0, </div><div class="line">                        &quot;DeleteOnTermination&quot;: true, </div><div class="line">                        &quot;AttachmentId&quot;: &quot;eni-attach-dcda6e8c&quot;, </div><div class="line">                        &quot;AttachTime&quot;: &quot;2017-03-18T22:23:48.000Z&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;Groups&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                            &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;Ipv6Addresses&quot;: [], </div><div class="line">                    &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                    &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">                    &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;</div><div class="line">                &#125;</div><div class="line">            ], </div><div class="line">            &quot;SourceDestCheck&quot;: true, </div><div class="line">            &quot;Placement&quot;: &#123;</div><div class="line">                &quot;Tenancy&quot;: &quot;default&quot;, </div><div class="line">                &quot;GroupName&quot;: &quot;&quot;, </div><div class="line">                &quot;AvailabilityZone&quot;: &quot;us-east-1b&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;Hypervisor&quot;: &quot;xen&quot;, </div><div class="line">            &quot;BlockDeviceMappings&quot;: [], </div><div class="line">            &quot;Architecture&quot;: &quot;x86_64&quot;, </div><div class="line">            &quot;StateReason&quot;: &#123;</div><div class="line">                &quot;Message&quot;: &quot;pending&quot;, </div><div class="line">                &quot;Code&quot;: &quot;pending&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;RootDeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">            &quot;VirtualizationType&quot;: &quot;hvm&quot;, </div><div class="line">            &quot;AmiLaunchIndex&quot;: 0</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line"></div><div class="line">➜  ~ git:(master) ✗ aws ec2 describe-instances --filters &quot;Name=image-id,Values=ami-b63769a1&quot;</div><div class="line">&#123;</div><div class="line">    &quot;Reservations&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">            &quot;ReservationId&quot;: &quot;r-003997252666b66c6&quot;, </div><div class="line">            &quot;Groups&quot;: [], </div><div class="line">            &quot;Instances&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;Monitoring&quot;: &#123;</div><div class="line">                        &quot;State&quot;: &quot;disabled&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;PublicDnsName&quot;: &quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;, </div><div class="line">                    &quot;State&quot;: &#123;</div><div class="line">                        &quot;Code&quot;: 16, </div><div class="line">                        &quot;Name&quot;: &quot;running&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;EbsOptimized&quot;: false, </div><div class="line">                    &quot;LaunchTime&quot;: &quot;2017-03-18T22:23:48.000Z&quot;, </div><div class="line">                    &quot;PublicIpAddress&quot;: &quot;54.91.19.43&quot;, </div><div class="line">                    &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;, </div><div class="line">                    &quot;ProductCodes&quot;: [], </div><div class="line">                    &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                    &quot;StateTransitionReason&quot;: &quot;&quot;, </div><div class="line">                    &quot;InstanceId&quot;: &quot;i-0c7d5c4b3a4726bd7&quot;, </div><div class="line">                    &quot;ImageId&quot;: &quot;ami-b63769a1&quot;, </div><div class="line">                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">                    &quot;KeyName&quot;: &quot;keypair3&quot;, </div><div class="line">                    &quot;SecurityGroups&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                            &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;ClientToken&quot;: &quot;&quot;, </div><div class="line">                    &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                    &quot;InstanceType&quot;: &quot;t2.micro&quot;, </div><div class="line">                    &quot;NetworkInterfaces&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;Status&quot;: &quot;in-use&quot;, </div><div class="line">                            &quot;MacAddress&quot;: &quot;0e:db:b6:0f:70:54&quot;, </div><div class="line">                            &quot;SourceDestCheck&quot;: true, </div><div class="line">                            &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                            &quot;Description&quot;: &quot;&quot;, </div><div class="line">                            &quot;Association&quot;: &#123;</div><div class="line">                                &quot;PublicIp&quot;: &quot;54.91.19.43&quot;, </div><div class="line">                                &quot;PublicDnsName&quot;: &quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;, </div><div class="line">                                &quot;IpOwnerId&quot;: &quot;amazon&quot;</div><div class="line">                            &#125;, </div><div class="line">                            &quot;NetworkInterfaceId&quot;: &quot;eni-423bf184&quot;, </div><div class="line">                            &quot;PrivateIpAddresses&quot;: [</div><div class="line">                                &#123;</div><div class="line">                                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">                                    &quot;Association&quot;: &#123;</div><div class="line">                                        &quot;PublicIp&quot;: &quot;54.91.19.43&quot;, </div><div class="line">                                        &quot;PublicDnsName&quot;: &quot;ec2-54-91-19-43.compute-1.amazonaws.com&quot;, </div><div class="line">                                        &quot;IpOwnerId&quot;: &quot;amazon&quot;</div><div class="line">                                    &#125;, </div><div class="line">                                    &quot;Primary&quot;: true, </div><div class="line">                                    &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;</div><div class="line">                                &#125;</div><div class="line">                            ], </div><div class="line">                            &quot;PrivateDnsName&quot;: &quot;ip-172-31-30-115.ec2.internal&quot;, </div><div class="line">                            &quot;Attachment&quot;: &#123;</div><div class="line">                                &quot;Status&quot;: &quot;attached&quot;, </div><div class="line">                                &quot;DeviceIndex&quot;: 0, </div><div class="line">                                &quot;DeleteOnTermination&quot;: true, </div><div class="line">                                &quot;AttachmentId&quot;: &quot;eni-attach-dcda6e8c&quot;, </div><div class="line">                                &quot;AttachTime&quot;: &quot;2017-03-18T22:23:48.000Z&quot;</div><div class="line">                            &#125;, </div><div class="line">                            &quot;Groups&quot;: [</div><div class="line">                                &#123;</div><div class="line">                                    &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                                    &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                                &#125;</div><div class="line">                            ], </div><div class="line">                            &quot;Ipv6Addresses&quot;: [], </div><div class="line">                            &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                            &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">                            &quot;PrivateIpAddress&quot;: &quot;172.31.30.115&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;SourceDestCheck&quot;: true, </div><div class="line">                    &quot;Placement&quot;: &#123;</div><div class="line">                        &quot;Tenancy&quot;: &quot;default&quot;, </div><div class="line">                        &quot;GroupName&quot;: &quot;&quot;, </div><div class="line">                        &quot;AvailabilityZone&quot;: &quot;us-east-1b&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;Hypervisor&quot;: &quot;xen&quot;, </div><div class="line">                    &quot;BlockDeviceMappings&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;DeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">                            &quot;Ebs&quot;: &#123;</div><div class="line">                                &quot;Status&quot;: &quot;attached&quot;, </div><div class="line">                                &quot;DeleteOnTermination&quot;: true, </div><div class="line">                                &quot;VolumeId&quot;: &quot;vol-0e34a21597e2a21f6&quot;, </div><div class="line">                                &quot;AttachTime&quot;: &quot;2017-03-18T22:23:49.000Z&quot;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;Architecture&quot;: &quot;x86_64&quot;, </div><div class="line">                    &quot;RootDeviceType&quot;: &quot;ebs&quot;, </div><div class="line">                    &quot;RootDeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">                    &quot;VirtualizationType&quot;: &quot;hvm&quot;, </div><div class="line">                    &quot;AmiLaunchIndex&quot;: 0</div><div class="line">                &#125;</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Install-package-bind-bind-utils-and-caching-nameserver"><a href="#Install-package-bind-bind-utils-and-caching-nameserver" class="headerlink" title="Install package bind, bind-utils and caching-nameserver."></a>Install package <code>bind</code>, <code>bind-utils</code> and <code>caching-nameserver</code>.</h2><p>Public DNS: ec2-54-91-19-43.compute-1.amazonaws.com</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div></pre></td><td class="code"><pre><div class="line">➜  Documents git:(master) ✗ ssh -i p.pem ec2-user@ec2-54-91-19-43.compute-1.amazonaws.com</div><div class="line">[ec2-user@ip-172-31-30-115 ~]$ </div><div class="line">[ec2-user@ip-172-31-30-115 ~]$ yum install bind</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</div><div class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/product/rhui-client-config-server-7.crt</div><div class="line">Repo rhui-REGION-client-config-server-7 forced skip_if_unavailable=True due to: /etc/pki/rhui/rhui-client-config-server-7.key</div><div class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</div><div class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/product/content-rhel7.crt</div><div class="line">Repo rhui-REGION-rhel-server-releases forced skip_if_unavailable=True due to: /etc/pki/rhui/content-rhel7.key</div><div class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/cdn.redhat.com-chain.crt</div><div class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/product/content-rhel7.crt</div><div class="line">Repo rhui-REGION-rhel-server-rh-common forced skip_if_unavailable=True due to: /etc/pki/rhui/content-rhel7.key</div><div class="line">You need to be root to perform this command.</div><div class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install bind</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">rhui-REGION-client-config-server-7                       | 2.9 kB     00:00     </div><div class="line">rhui-REGION-rhel-server-releases                         | 3.5 kB     00:00     </div><div class="line">rhui-REGION-rhel-server-rh-common                        | 3.8 kB     00:00     </div><div class="line">(1/7): rhui-REGION-client-config-server-7/x86_64/primary_d | 5.5 kB   00:00     </div><div class="line">(2/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/gr |  104 B   00:00     </div><div class="line">(3/7): rhui-REGION-rhel-server-releases/7Server/x86_64/gro | 701 kB   00:00     </div><div class="line">(4/7): rhui-REGION-rhel-server-releases/7Server/x86_64/upd | 1.8 MB   00:00     </div><div class="line">(5/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/up |  30 kB   00:00     </div><div class="line">(6/7): rhui-REGION-rhel-server-rh-common/7Server/x86_64/pr | 112 kB   00:00     </div><div class="line">(7/7): rhui-REGION-rhel-server-releases/7Server/x86_64/pri |  34 MB   00:01     </div><div class="line">Resolving Dependencies</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package bind.x86_64 32:9.9.4-38.el7_3.2 will be installed</div><div class="line">--&gt; Processing Dependency: bind-libs = 32:9.9.4-38.el7_3.2 for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: libbind9.so.90()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: libdns.so.100()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: libisc.so.95()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: libisccc.so.90()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: libisccfg.so.90()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Processing Dependency: liblwres.so.90()(64bit) for package: 32:bind-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package bind-libs.x86_64 32:9.9.4-38.el7_3.2 will be installed</div><div class="line">--&gt; Processing Dependency: bind-license = 32:9.9.4-38.el7_3.2 for package: 32:bind-libs-9.9.4-38.el7_3.2.x86_64</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package bind-license.noarch 32:9.9.4-37.el7 will be updated</div><div class="line">--&gt; Processing Dependency: bind-license = 32:9.9.4-37.el7 for package: 32:bind-libs-lite-9.9.4-37.el7.x86_64</div><div class="line">---&gt; Package bind-license.noarch 32:9.9.4-38.el7_3.2 will be an update</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package bind-libs-lite.x86_64 32:9.9.4-37.el7 will be updated</div><div class="line">---&gt; Package bind-libs-lite.x86_64 32:9.9.4-38.el7_3.2 will be an update</div><div class="line">--&gt; Finished Dependency Resolution</div><div class="line"></div><div class="line">Dependencies Resolved</div><div class="line"></div><div class="line">================================================================================</div><div class="line"> Package      Arch   Version             Repository                        Size</div><div class="line">================================================================================</div><div class="line">Installing:</div><div class="line"> bind         x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 1.8 M</div><div class="line">Installing for dependencies:</div><div class="line"> bind-libs    x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 1.0 M</div><div class="line">Updating for dependencies:</div><div class="line"> bind-libs-lite</div><div class="line">              x86_64 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases 730 k</div><div class="line"> bind-license noarch 32:9.9.4-38.el7_3.2 rhui-REGION-rhel-server-releases  83 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">================================================================================</div><div class="line">Install  1 Package  (+1 Dependent package)</div><div class="line">Upgrade             ( 2 Dependent packages)</div><div class="line"></div><div class="line">Total download size: 3.6 M</div><div class="line">Is this ok [y/d/N]: y</div><div class="line">Downloading packages:</div><div class="line">Delta RPMs disabled because /usr/bin/applydeltarpm not installed.</div><div class="line">(1/4): bind-libs-9.9.4-38.el7_3.2.x86_64.rpm               | 1.0 MB   00:00     </div><div class="line">(2/4): bind-9.9.4-38.el7_3.2.x86_64.rpm                    | 1.8 MB   00:00     </div><div class="line">(3/4): bind-libs-lite-9.9.4-38.el7_3.2.x86_64.rpm          | 730 kB   00:00     </div><div class="line">(4/4): bind-license-9.9.4-38.el7_3.2.noarch.rpm            |  83 kB   00:00     </div><div class="line">--------------------------------------------------------------------------------</div><div class="line">Total                                              7.4 MB/s | 3.6 MB  00:00     </div><div class="line">Running transaction check</div><div class="line">Running transaction test</div><div class="line">Transaction test succeeded</div><div class="line">Running transaction</div><div class="line">  Updating   : 32:bind-license-9.9.4-38.el7_3.2.noarch                      1/6 </div><div class="line">  Installing : 32:bind-libs-9.9.4-38.el7_3.2.x86_64                         2/6 </div><div class="line">  Installing : 32:bind-9.9.4-38.el7_3.2.x86_64                              3/6 </div><div class="line">  Updating   : 32:bind-libs-lite-9.9.4-38.el7_3.2.x86_64                    4/6 </div><div class="line">  Cleanup    : 32:bind-libs-lite-9.9.4-37.el7.x86_64                        5/6 </div><div class="line">  Cleanup    : 32:bind-license-9.9.4-37.el7.noarch                          6/6 </div><div class="line">  Verifying  : 32:bind-9.9.4-38.el7_3.2.x86_64                              1/6 </div><div class="line">  Verifying  : 32:bind-libs-lite-9.9.4-38.el7_3.2.x86_64                    2/6 </div><div class="line">  Verifying  : 32:bind-libs-9.9.4-38.el7_3.2.x86_64                         3/6 </div><div class="line">  Verifying  : 32:bind-license-9.9.4-38.el7_3.2.noarch                      4/6 </div><div class="line">  Verifying  : 32:bind-libs-lite-9.9.4-37.el7.x86_64                        5/6 </div><div class="line">  Verifying  : 32:bind-license-9.9.4-37.el7.noarch                          6/6 </div><div class="line"></div><div class="line">Installed:</div><div class="line">  bind.x86_64 32:9.9.4-38.el7_3.2                                               </div><div class="line"></div><div class="line">Dependency Installed:</div><div class="line">  bind-libs.x86_64 32:9.9.4-38.el7_3.2                                          </div><div class="line"></div><div class="line">Dependency Updated:</div><div class="line">  bind-libs-lite.x86_64 32:9.9.4-38.el7_3.2                                     </div><div class="line">  bind-license.noarch 32:9.9.4-38.el7_3.2                                       </div><div class="line"></div><div class="line">Complete!</div><div class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install bind-utils</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">Resolving Dependencies</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package bind-utils.x86_64 32:9.9.4-38.el7_3.2 will be installed</div><div class="line">--&gt; Finished Dependency Resolution</div><div class="line"></div><div class="line">Dependencies Resolved</div><div class="line"></div><div class="line">================================================================================</div><div class="line"> Package    Arch   Version               Repository                        Size</div><div class="line">================================================================================</div><div class="line">Installing:</div><div class="line"> bind-utils x86_64 32:9.9.4-38.el7_3.2   rhui-REGION-rhel-server-releases 202 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">================================================================================</div><div class="line">Install  1 Package</div><div class="line"></div><div class="line">Total download size: 202 k</div><div class="line">Installed size: 434 k</div><div class="line">Is this ok [y/d/N]: y</div><div class="line">Downloading packages:</div><div class="line">bind-utils-9.9.4-38.el7_3.2.x86_64.rpm                     | 202 kB   00:00     </div><div class="line">Running transaction check</div><div class="line">Running transaction test</div><div class="line">Transaction test succeeded</div><div class="line">Running transaction</div><div class="line">  Installing : 32:bind-utils-9.9.4-38.el7_3.2.x86_64                        1/1 </div><div class="line">  Verifying  : 32:bind-utils-9.9.4-38.el7_3.2.x86_64                        1/1 </div><div class="line"></div><div class="line">Installed:</div><div class="line">  bind-utils.x86_64 32:9.9.4-38.el7_3.2                                         </div><div class="line"></div><div class="line">Complete!</div><div class="line">[ec2-user@ip-172-31-30-115 ~]$ sudo yum install caching-nameserver</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">Package 32:bind-9.9.4-38.el7_3.2.x86_64 already installed and latest version</div><div class="line">Nothing to do</div></pre></td></tr></table></figure>
<h2 id="Modify-the-file-‘-etc-named-conf’"><a href="#Modify-the-file-‘-etc-named-conf’" class="headerlink" title="Modify the file ‘/etc/named.conf’"></a>Modify the file ‘/etc/named.conf’</h2><p>Then I look the file <code>/etc/named.conf</code>:<br>This file has limit of permission. I use root as user.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[ec2-user@ip-172-31-30-115 var]$ sudo su</div><div class="line">[root@ip-172-31-30-115 etc]# vi named.conf</div></pre></td></tr></table></figure>
<p>Modify:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">//</div><div class="line">// named.conf</div><div class="line">//</div><div class="line">// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS</div><div class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</div><div class="line">//</div><div class="line">// See /usr/share/doc/bind*/sample/ for example named configuration files.</div><div class="line">//</div><div class="line">// See the BIND Administrator&apos;s Reference Manual (ARM) for details about the</div><div class="line">// configuration located in /usr/share/doc/bind-&#123;version&#125;/Bv9ARM.html</div><div class="line"></div><div class="line">options &#123;</div><div class="line">        listen-on port 53 &#123; 127.0.0.1; any; &#125;;</div><div class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</div><div class="line">        directory       &quot;/var/named&quot;;</div><div class="line">        dump-file       &quot;/var/named/data/cache_dump.db&quot;;</div><div class="line">        statistics-file &quot;/var/named/data/named_stats.txt&quot;;</div><div class="line">        memstatistics-file &quot;/var/named/data/named_mem_stats.txt&quot;;</div><div class="line">        allow-query     &#123; localhost; any; &#125;;</div><div class="line">        allow-query-cache &#123; localhost; any; &#125;;</div><div class="line"></div><div class="line">        /*</div><div class="line">         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.</div><div class="line">         - If you are building a RECURSIVE (caching) DNS server, you need to enable recursion.</div><div class="line">         - If your recursive DNS server has a public IP address, you MUST enable access</div><div class="line">           control to limit queries to your legitimate users. Failing to do so will</div><div class="line">           cause your server to become part of large scale DNS amplification</div><div class="line">           attacks. Implementing BCP38 within your network would greatly</div><div class="line">           reduce such attack surface</div><div class="line">        */</div><div class="line">        recursion yes;</div><div class="line"></div><div class="line">        dnssec-enable yes;</div><div class="line">        dnssec-validation yes;</div><div class="line"></div><div class="line">        /* Path to ISC DLV key */</div><div class="line">        bindkeys-file &quot;/etc/named.iscdlv.key&quot;;</div><div class="line"></div><div class="line">        managed-keys-directory &quot;/var/named/dynamic&quot;;</div><div class="line"></div><div class="line">        pid-file &quot;/run/named/named.pid&quot;;</div><div class="line">        session-keyfile &quot;/run/named/session.key&quot;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">logging &#123;</div><div class="line">        channel default_debug &#123;</div><div class="line">                file &quot;data/named.run&quot;;</div><div class="line">                severity dynamic;</div><div class="line">        &#125;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">zone &quot;.&quot; IN &#123;</div><div class="line">        type hint;</div><div class="line">        file &quot;named.ca&quot;;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"></div><div class="line">include &quot;/etc/named.rfc1912.zones&quot;;</div><div class="line">include &quot;/etc/named.root.key&quot;;</div></pre></td></tr></table></figure>
<h2 id="Look-the-file-‘named-ca’"><a href="#Look-the-file-‘named-ca’" class="headerlink" title="Look the file ‘named.ca’:"></a>Look the file ‘named.ca’:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 etc]# vi /var/named/named.ca</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">; &lt;&lt;&gt;&gt; DiG 9.9.2-P1-RedHat-9.9.2-6.P1.fc18 &lt;&lt;&gt;&gt; +bufsize=1200 +norec @a.root-servers.net</div><div class="line">; (2 servers found)</div><div class="line">;; global options: +cmd</div><div class="line">;; Got answer:</div><div class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 25828</div><div class="line">;; flags: qr aa; QUERY: 1, ANSWER: 13, AUTHORITY: 0, ADDITIONAL: 23</div><div class="line"></div><div class="line">;; OPT PSEUDOSECTION:</div><div class="line">; EDNS: version: 0, flags:; udp: 512</div><div class="line">;; QUESTION SECTION:</div><div class="line">;.                              IN      NS</div><div class="line"></div><div class="line">;; ANSWER SECTION:</div><div class="line">.                       518400  IN      NS      a.root-servers.net.</div><div class="line">.                       518400  IN      NS      b.root-servers.net.</div><div class="line">.                       518400  IN      NS      c.root-servers.net.</div><div class="line">.                       518400  IN      NS      d.root-servers.net.</div><div class="line">.                       518400  IN      NS      e.root-servers.net.</div><div class="line">.                       518400  IN      NS      f.root-servers.net.</div><div class="line">.                       518400  IN      NS      g.root-servers.net.</div><div class="line">.                       518400  IN      NS      h.root-servers.net.</div><div class="line">.                       518400  IN      NS      i.root-servers.net.</div><div class="line">.                       518400  IN      NS      j.root-servers.net.</div><div class="line">.                       518400  IN      NS      k.root-servers.net.</div><div class="line">.                       518400  IN      NS      l.root-servers.net.</div><div class="line">.                       518400  IN      NS      m.root-servers.net.</div><div class="line"></div><div class="line">;; ADDITIONAL SECTION:</div><div class="line">a.root-servers.net.     3600000 IN      A       198.41.0.4</div><div class="line">a.root-servers.net.     3600000 IN      AAAA    2001:503:ba3e::2:30</div><div class="line">b.root-servers.net.     3600000 IN      A       192.228.79.201</div><div class="line">c.root-servers.net.     3600000 IN      A       192.33.4.12</div><div class="line">d.root-servers.net.     3600000 IN      A       199.7.91.13</div><div class="line">d.root-servers.net.     3600000 IN      AAAA    2001:500:2d::d</div><div class="line">e.root-servers.net.     3600000 IN      A       192.203.230.10</div><div class="line">f.root-servers.net.     3600000 IN      A       192.5.5.241</div><div class="line">f.root-servers.net.     3600000 IN      AAAA    2001:500:2f::f</div><div class="line">g.root-servers.net.     3600000 IN      A       192.112.36.4</div><div class="line">h.root-servers.net.     3600000 IN      A       128.63.2.53</div><div class="line">h.root-servers.net.     3600000 IN      AAAA    2001:500:1::803f:235</div><div class="line">i.root-servers.net.     3600000 IN      A       192.36.148.17</div><div class="line">i.root-servers.net.     3600000 IN      AAAA    2001:7fe::53</div><div class="line">j.root-servers.net.     3600000 IN      A       192.58.128.30</div><div class="line">j.root-servers.net.     3600000 IN      AAAA    2001:503:c27::2:30</div><div class="line">k.root-servers.net.     3600000 IN      A       193.0.14.129</div><div class="line">k.root-servers.net.     3600000 IN      AAAA    2001:7fd::1</div><div class="line">l.root-servers.net.     3600000 IN      A       199.7.83.42</div><div class="line">l.root-servers.net.     3600000 IN      AAAA    2001:500:3::42</div><div class="line">m.root-servers.net.     3600000 IN      A       202.12.27.33</div><div class="line">m.root-servers.net.     3600000 IN      AAAA    2001:dc3::35</div><div class="line"></div><div class="line">;; Query time: 78 msec</div><div class="line">;; SERVER: 198.41.0.4#53(198.41.0.4)</div><div class="line">;; WHEN: Mon Jan 28 15:33:31 2013</div><div class="line">;; MSG SIZE  rcvd: 699</div></pre></td></tr></table></figure>
<h2 id="Modify-the-file-‘etc-resolv-conf’"><a href="#Modify-the-file-‘etc-resolv-conf’" class="headerlink" title="Modify the file ‘etc/resolv.conf’:"></a>Modify the file ‘etc/resolv.conf’:</h2><p>The <code>nameserver&#39; line specifies the address of nameserver.
The</code>search` set the searching order of client request:<br>If a client tries to look up foo, then foo.subdomain.your-domain.edu is tried first, then foo.your-domain.edu, and finally foo. You may not want to put in too many domains in the search line, as it takes time to search them all.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Generated by NetworkManager</div><div class="line">search subdomain.your-domain.edu your-domain.edu</div><div class="line">nameserver 127.0.0.1</div></pre></td></tr></table></figure>
<h2 id="Deploy-the-Cache-only-DNS-server-within-chroot-environment"><a href="#Deploy-the-Cache-only-DNS-server-within-chroot-environment" class="headerlink" title="Deploy the Cache-only DNS server within chroot environment"></a>Deploy the Cache-only DNS server within chroot environment</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># yum install bind-chroot -y</div><div class="line"># systemctl restart named</div><div class="line"># ln -s /etc/named.conf /var/named/chroot/etc/named.conf</div></pre></td></tr></table></figure>
<h2 id="Start-the-named-server"><a href="#Start-the-named-server" class="headerlink" title="Start the named server"></a>Start the named server</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 network-scripts]# systemctl restart named</div><div class="line">[root@ip-172-31-30-115 network-scripts]# systemctl enable named</div><div class="line">[root@ip-172-31-30-115 network-scripts]# systemctl status named</div><div class="line">● named.service - Berkeley Internet Name Domain (DNS)</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/named.service; enabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since Sun 2017-03-19 01:09:45 EDT; 10s ago</div><div class="line"> Main PID: 17623 (named)</div><div class="line">   CGroup: /system.slice/named.service</div><div class="line">           └─17623 /usr/sbin/named -u named</div><div class="line"></div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: command channel listening on ::1#953</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: managed-keys-zone: loaded serial 2</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal systemd[1]: Started Berkeley Internet Name Domain (DNS).</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 0.in-addr.arpa/IN: loaded serial 0</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 1.0.0.127.in-addr.arpa/IN: loaded serial 0</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone 1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0....ial 0</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone localhost/IN: loaded serial 0</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: zone localhost.localdomain/IN: loaded serial 0</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: all zones loaded</div><div class="line">Mar 19 01:09:45 ip-172-31-30-115.ec2.internal named[17623]: running</div><div class="line">Hint: Some lines were ellipsized, use -l to show in full.</div></pre></td></tr></table></figure>
<h2 id="Configured-the-client"><a href="#Configured-the-client" class="headerlink" title="Configured the client"></a>Configured the client</h2><h3 id="Create-an-instance-as-our-client"><a href="#Create-an-instance-as-our-client" class="headerlink" title="Create an instance as our client"></a>Create an instance as our client</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div></pre></td><td class="code"><pre><div class="line">➜  ~ git:(master) ✗ aws ec2 run-instances --image-id ami-b63769a1 --count 1 --instance-type t2.micro --key-name keypair3 --security-groups mysg</div><div class="line">&#123;</div><div class="line">    &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">    &quot;ReservationId&quot;: &quot;r-07677d6d1f894a149&quot;, </div><div class="line">    &quot;Groups&quot;: [], </div><div class="line">    &quot;Instances&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;Monitoring&quot;: &#123;</div><div class="line">                &quot;State&quot;: &quot;disabled&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;PublicDnsName&quot;: &quot;&quot;, </div><div class="line">            &quot;RootDeviceType&quot;: &quot;ebs&quot;, </div><div class="line">            &quot;State&quot;: &#123;</div><div class="line">                &quot;Code&quot;: 0, </div><div class="line">                &quot;Name&quot;: &quot;pending&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;EbsOptimized&quot;: false, </div><div class="line">            &quot;LaunchTime&quot;: &quot;2017-03-19T04:29:59.000Z&quot;, </div><div class="line">            &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;, </div><div class="line">            &quot;ProductCodes&quot;: [], </div><div class="line">            &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">            &quot;StateTransitionReason&quot;: &quot;&quot;, </div><div class="line">            &quot;InstanceId&quot;: &quot;i-077fb91e833447d9b&quot;, </div><div class="line">            &quot;ImageId&quot;: &quot;ami-b63769a1&quot;, </div><div class="line">            &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">            &quot;KeyName&quot;: &quot;keypair3&quot;, </div><div class="line">            &quot;SecurityGroups&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                    &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                &#125;</div><div class="line">            ], </div><div class="line">            &quot;ClientToken&quot;: &quot;&quot;, </div><div class="line">            &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">            &quot;InstanceType&quot;: &quot;t2.micro&quot;, </div><div class="line">            &quot;NetworkInterfaces&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;Status&quot;: &quot;in-use&quot;, </div><div class="line">                    &quot;MacAddress&quot;: &quot;0e:b4:86:cf:b2:78&quot;, </div><div class="line">                    &quot;SourceDestCheck&quot;: true, </div><div class="line">                    &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                    &quot;Description&quot;: &quot;&quot;, </div><div class="line">                    &quot;NetworkInterfaceId&quot;: &quot;eni-00f324c6&quot;, </div><div class="line">                    &quot;PrivateIpAddresses&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">                            &quot;Primary&quot;: true, </div><div class="line">                            &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">                    &quot;Attachment&quot;: &#123;</div><div class="line">                        &quot;Status&quot;: &quot;attaching&quot;, </div><div class="line">                        &quot;DeviceIndex&quot;: 0, </div><div class="line">                        &quot;DeleteOnTermination&quot;: true, </div><div class="line">                        &quot;AttachmentId&quot;: &quot;eni-attach-cb5aed9b&quot;, </div><div class="line">                        &quot;AttachTime&quot;: &quot;2017-03-19T04:29:59.000Z&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;Groups&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                            &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;Ipv6Addresses&quot;: [], </div><div class="line">                    &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                    &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">                    &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;</div><div class="line">                &#125;</div><div class="line">            ], </div><div class="line">            &quot;SourceDestCheck&quot;: true, </div><div class="line">            &quot;Placement&quot;: &#123;</div><div class="line">                &quot;Tenancy&quot;: &quot;default&quot;, </div><div class="line">                &quot;GroupName&quot;: &quot;&quot;, </div><div class="line">                &quot;AvailabilityZone&quot;: &quot;us-east-1b&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;Hypervisor&quot;: &quot;xen&quot;, </div><div class="line">            &quot;BlockDeviceMappings&quot;: [], </div><div class="line">            &quot;Architecture&quot;: &quot;x86_64&quot;, </div><div class="line">            &quot;StateReason&quot;: &#123;</div><div class="line">                &quot;Message&quot;: &quot;pending&quot;, </div><div class="line">                &quot;Code&quot;: &quot;pending&quot;</div><div class="line">            &#125;, </div><div class="line">            &quot;RootDeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">            &quot;VirtualizationType&quot;: &quot;hvm&quot;, </div><div class="line">            &quot;AmiLaunchIndex&quot;: 0</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div><div class="line"></div><div class="line">➜  ~ git:(master) ✗ aws ec2 describe-instances --filters &quot;Name=instance-id,Values=i-077fb91e833447d9b&quot;</div><div class="line">&#123;</div><div class="line">    &quot;Reservations&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">            &quot;ReservationId&quot;: &quot;r-07677d6d1f894a149&quot;, </div><div class="line">            &quot;Groups&quot;: [], </div><div class="line">            &quot;Instances&quot;: [</div><div class="line">                &#123;</div><div class="line">                    &quot;Monitoring&quot;: &#123;</div><div class="line">                        &quot;State&quot;: &quot;disabled&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;PublicDnsName&quot;: &quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;, </div><div class="line">                    &quot;State&quot;: &#123;</div><div class="line">                        &quot;Code&quot;: 16, </div><div class="line">                        &quot;Name&quot;: &quot;running&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;EbsOptimized&quot;: false, </div><div class="line">                    &quot;LaunchTime&quot;: &quot;2017-03-19T04:29:59.000Z&quot;, </div><div class="line">                    &quot;PublicIpAddress&quot;: &quot;54.242.90.155&quot;, </div><div class="line">                    &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;, </div><div class="line">                    &quot;ProductCodes&quot;: [], </div><div class="line">                    &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                    &quot;StateTransitionReason&quot;: &quot;&quot;, </div><div class="line">                    &quot;InstanceId&quot;: &quot;i-077fb91e833447d9b&quot;, </div><div class="line">                    &quot;ImageId&quot;: &quot;ami-b63769a1&quot;, </div><div class="line">                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">                    &quot;KeyName&quot;: &quot;keypair3&quot;, </div><div class="line">                    &quot;SecurityGroups&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                            &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;ClientToken&quot;: &quot;&quot;, </div><div class="line">                    &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                    &quot;InstanceType&quot;: &quot;t2.micro&quot;, </div><div class="line">                    &quot;NetworkInterfaces&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;Status&quot;: &quot;in-use&quot;, </div><div class="line">                            &quot;MacAddress&quot;: &quot;0e:b4:86:cf:b2:78&quot;, </div><div class="line">                            &quot;SourceDestCheck&quot;: true, </div><div class="line">                            &quot;VpcId&quot;: &quot;vpc-adb325cb&quot;, </div><div class="line">                            &quot;Description&quot;: &quot;&quot;, </div><div class="line">                            &quot;Association&quot;: &#123;</div><div class="line">                                &quot;PublicIp&quot;: &quot;54.242.90.155&quot;, </div><div class="line">                                &quot;PublicDnsName&quot;: &quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;, </div><div class="line">                                &quot;IpOwnerId&quot;: &quot;amazon&quot;</div><div class="line">                            &#125;, </div><div class="line">                            &quot;NetworkInterfaceId&quot;: &quot;eni-00f324c6&quot;, </div><div class="line">                            &quot;PrivateIpAddresses&quot;: [</div><div class="line">                                &#123;</div><div class="line">                                    &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">                                    &quot;Association&quot;: &#123;</div><div class="line">                                        &quot;PublicIp&quot;: &quot;54.242.90.155&quot;, </div><div class="line">                                        &quot;PublicDnsName&quot;: &quot;ec2-54-242-90-155.compute-1.amazonaws.com&quot;, </div><div class="line">                                        &quot;IpOwnerId&quot;: &quot;amazon&quot;</div><div class="line">                                    &#125;, </div><div class="line">                                    &quot;Primary&quot;: true, </div><div class="line">                                    &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;</div><div class="line">                                &#125;</div><div class="line">                            ], </div><div class="line">                            &quot;PrivateDnsName&quot;: &quot;ip-172-31-23-114.ec2.internal&quot;, </div><div class="line">                            &quot;Attachment&quot;: &#123;</div><div class="line">                                &quot;Status&quot;: &quot;attached&quot;, </div><div class="line">                                &quot;DeviceIndex&quot;: 0, </div><div class="line">                                &quot;DeleteOnTermination&quot;: true, </div><div class="line">                                &quot;AttachmentId&quot;: &quot;eni-attach-cb5aed9b&quot;, </div><div class="line">                                &quot;AttachTime&quot;: &quot;2017-03-19T04:29:59.000Z&quot;</div><div class="line">                            &#125;, </div><div class="line">                            &quot;Groups&quot;: [</div><div class="line">                                &#123;</div><div class="line">                                    &quot;GroupName&quot;: &quot;mysg&quot;, </div><div class="line">                                    &quot;GroupId&quot;: &quot;sg-a364e4df&quot;</div><div class="line">                                &#125;</div><div class="line">                            ], </div><div class="line">                            &quot;Ipv6Addresses&quot;: [], </div><div class="line">                            &quot;SubnetId&quot;: &quot;subnet-09dda752&quot;, </div><div class="line">                            &quot;OwnerId&quot;: &quot;624990436890&quot;, </div><div class="line">                            &quot;PrivateIpAddress&quot;: &quot;172.31.23.114&quot;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;SourceDestCheck&quot;: true, </div><div class="line">                    &quot;Placement&quot;: &#123;</div><div class="line">                        &quot;Tenancy&quot;: &quot;default&quot;, </div><div class="line">                        &quot;GroupName&quot;: &quot;&quot;, </div><div class="line">                        &quot;AvailabilityZone&quot;: &quot;us-east-1b&quot;</div><div class="line">                    &#125;, </div><div class="line">                    &quot;Hypervisor&quot;: &quot;xen&quot;, </div><div class="line">                    &quot;BlockDeviceMappings&quot;: [</div><div class="line">                        &#123;</div><div class="line">                            &quot;DeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">                            &quot;Ebs&quot;: &#123;</div><div class="line">                                &quot;Status&quot;: &quot;attached&quot;, </div><div class="line">                                &quot;DeleteOnTermination&quot;: true, </div><div class="line">                                &quot;VolumeId&quot;: &quot;vol-033fa93cda37a3621&quot;, </div><div class="line">                                &quot;AttachTime&quot;: &quot;2017-03-19T04:30:00.000Z&quot;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    ], </div><div class="line">                    &quot;Architecture&quot;: &quot;x86_64&quot;, </div><div class="line">                    &quot;RootDeviceType&quot;: &quot;ebs&quot;, </div><div class="line">                    &quot;RootDeviceName&quot;: &quot;/dev/sda1&quot;, </div><div class="line">                    &quot;VirtualizationType&quot;: &quot;hvm&quot;, </div><div class="line">                    &quot;AmiLaunchIndex&quot;: 0</div><div class="line">                &#125;</div><div class="line">            ]</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>According to the above, our named server “PublicIpAddress” is “54.91.19.43”.<br>Clinet Public Dns is “ec2-54-242-90-155.compute-1.amazonaws.com”.</p>
<p>SSH to the client and change to ‘root’ user.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">➜  Documents git:(master) ✗ ssh -i p.pem ec2-user@ec2-54-242-90-155.compute-1.amazonaws.com</div><div class="line">The authenticity of host &apos;ec2-54-242-90-155.compute-1.amazonaws.com (54.242.90.155)&apos; can&apos;t be established.</div><div class="line">ECDSA key fingerprint is SHA256:RjBCp8++iMcmgBP9LgmWNnBwz+/+gaFJmyooX7fFmnc.</div><div class="line">Are you sure you want to continue connecting (yes/no)? yes</div><div class="line">Warning: Permanently added &apos;ec2-54-242-90-155.compute-1.amazonaws.com,54.242.90.155&apos; (ECDSA) to the list of known hosts.</div><div class="line">[ec2-user@ip-172-31-23-114 ~]$ sudo su</div><div class="line">[root@ip-172-31-23-114 ec2-user]#</div></pre></td></tr></table></figure>
<p>Edit /etc/sysconfig/network-scripts/ifcfg-lo (add ‘DNS=54.91.19.43’ in the end):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">DEVICE=lo</div><div class="line">IPADDR=127.0.0.1</div><div class="line">NETMASK=255.0.0.0</div><div class="line">NETWORK=127.0.0.0</div><div class="line"># If you&apos;re having problems with gated making 127.0.0.0/8 a martian,</div><div class="line"># you can change this to something else (255.255.255.255, for example)</div><div class="line">BROADCAST=127.255.255.255</div><div class="line">ONBOOT=yes</div><div class="line">NAME=loopback</div><div class="line">DNS=54.91.19.43</div></pre></td></tr></table></figure>
<p>Edit /etc/resolv.conf:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[ec2-user@ip-172-31-23-114 ~]$ vi /etc/resolv.conf</div><div class="line"></div><div class="line">nameserver 54.91.19.43</div></pre></td></tr></table></figure>
<p>First, I find I can’t visit my name server. After a few mins, I realized that I didn’t set inbound of my ec2 security group to allow UDP request. Then I added rule of inbound to allow ALL UDP from my client ip in this security group.</p>
<h2 id="tcpdump-exercises"><a href="#tcpdump-exercises" class="headerlink" title="tcpdump exercises"></a>tcpdump exercises</h2><h3 id="First-scenario"><a href="#First-scenario" class="headerlink" title="First scenario"></a>First scenario</h3><h4 id="Install-telnet-and-tcpdump"><a href="#Install-telnet-and-tcpdump" class="headerlink" title="Install telnet and tcpdump"></a>Install telnet and tcpdump</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ec2-user]# yum install tcpdump</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">rhui-REGION-client-config-server-7                       | 2.9 kB     00:00     </div><div class="line">rhui-REGION-rhel-server-releases                         | 3.5 kB     00:00     </div><div class="line">rhui-REGION-rhel-server-rh-common                        | 3.8 kB     00:00     </div><div class="line">Resolving Dependencies</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package tcpdump.x86_64 14:4.5.1-3.el7 will be installed</div><div class="line">--&gt; Finished Dependency Resolution</div><div class="line"></div><div class="line">Dependencies Resolved</div><div class="line"></div><div class="line">================================================================================</div><div class="line"> Package   Arch     Version            Repository                          Size</div><div class="line">================================================================================</div><div class="line">Installing:</div><div class="line"> tcpdump   x86_64   14:4.5.1-3.el7     rhui-REGION-rhel-server-releases   388 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">================================================================================</div><div class="line">Install  1 Package</div><div class="line"></div><div class="line">Total download size: 388 k</div><div class="line">Installed size: 931 k</div><div class="line">Is this ok [y/d/N]: y</div><div class="line">Downloading packages:</div><div class="line">tcpdump-4.5.1-3.el7.x86_64.rpm                             | 388 kB   00:00     </div><div class="line">Running transaction check</div><div class="line">Running transaction test</div><div class="line">Transaction test succeeded</div><div class="line">Running transaction</div><div class="line">  Installing : 14:tcpdump-4.5.1-3.el7.x86_64                                1/1 </div><div class="line">  Verifying  : 14:tcpdump-4.5.1-3.el7.x86_64                                1/1 </div><div class="line"></div><div class="line">Installed:</div><div class="line">  tcpdump.x86_64 14:4.5.1-3.el7                                                 </div><div class="line"></div><div class="line">Complete!</div><div class="line"></div><div class="line">[root@ip-172-31-30-115 ec2-user]# yum install telnet</div><div class="line">Loaded plugins: amazon-id, rhui-lb, search-disabled-repos</div><div class="line">Resolving Dependencies</div><div class="line">--&gt; Running transaction check</div><div class="line">---&gt; Package telnet.x86_64 1:0.17-60.el7 will be installed</div><div class="line">--&gt; Finished Dependency Resolution</div><div class="line"></div><div class="line">Dependencies Resolved</div><div class="line"></div><div class="line">================================================================================</div><div class="line"> Package   Arch      Version          Repository                           Size</div><div class="line">================================================================================</div><div class="line">Installing:</div><div class="line"> telnet    x86_64    1:0.17-60.el7    rhui-REGION-rhel-server-releases     63 k</div><div class="line"></div><div class="line">Transaction Summary</div><div class="line">================================================================================</div><div class="line">Install  1 Package</div><div class="line"></div><div class="line">Total download size: 63 k</div><div class="line">Installed size: 113 k</div><div class="line">Is this ok [y/d/N]: y</div><div class="line">Downloading packages:</div><div class="line">telnet-0.17-60.el7.x86_64.rpm                              |  63 kB   00:00     </div><div class="line">Running transaction check</div><div class="line">Running transaction test</div><div class="line">Transaction test succeeded</div><div class="line">Running transaction</div><div class="line">  Installing : 1:telnet-0.17-60.el7.x86_64                                  1/1 </div><div class="line">  Verifying  : 1:telnet-0.17-60.el7.x86_64                                  1/1 </div><div class="line"></div><div class="line">Installed:</div><div class="line">  telnet.x86_64 1:0.17-60.el7                                                   </div><div class="line"></div><div class="line">Complete!</div></pre></td></tr></table></figure>
<h3 id="Set-tcpdump-to-record-package-information"><a href="#Set-tcpdump-to-record-package-information" class="headerlink" title="Set tcpdump to record package information"></a>Set tcpdump to record package information</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ec2-user]# tcpdump -w tcpdump.out port not 22 &amp;</div><div class="line">[1] 19985</div><div class="line">[root@ip-172-31-30-115 ec2-user]# tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</div><div class="line">arp -d -a</div><div class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</div><div class="line">[root@ip-172-31-30-115 ec2-user]# telnet www.yahoo.com 80</div><div class="line">Trying 98.139.180.149...</div><div class="line">Connected to www.yahoo.com.</div><div class="line">Escape character is &apos;^]&apos;.</div><div class="line">GET / HTTP/1.1</div><div class="line">Host: www.yahoo.com</div><div class="line"></div><div class="line">HTTP/1.1 301 Redirect</div><div class="line">Date: Mon, 20 Mar 2017 01:42:51 GMT</div><div class="line">Via: https/1.1 ir4.fp.bf1.yahoo.com (ApacheTrafficServer)</div><div class="line">Server: ATS</div><div class="line">Location: https://www.yahoo.com/</div><div class="line">Content-Type: text/html</div><div class="line">Content-Language: en</div><div class="line">Cache-Control: no-store, no-cache</div><div class="line">Connection: keep-alive</div><div class="line">Content-Length: 304</div><div class="line"></div><div class="line">&lt;HTML&gt;</div><div class="line">&lt;HEAD&gt;</div><div class="line">&lt;TITLE&gt;Document Has Moved&lt;/TITLE&gt;</div><div class="line">&lt;/HEAD&gt;</div><div class="line"></div><div class="line">&lt;BODY BGCOLOR=&quot;white&quot; FGCOLOR=&quot;black&quot;&gt;</div><div class="line">&lt;H1&gt;Document Has Moved&lt;/H1&gt;</div><div class="line">&lt;HR&gt;</div><div class="line"></div><div class="line">&lt;FONT FACE=&quot;Helvetica,Arial&quot;&gt;&lt;B&gt;</div><div class="line">Description: The document you requested has moved to a new location.  The new location is &quot;https://www.yahoo.com/&quot;.</div><div class="line">&lt;/B&gt;&lt;/FONT&gt;</div><div class="line">&lt;HR&gt;</div><div class="line">&lt;/BODY&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en-us&quot;&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">    &lt;title&gt;Yahoo&lt;/title&gt;</div><div class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimal-ui&quot;&gt;</div><div class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;</div><div class="line">    &lt;style&gt;</div><div class="line">      html &#123;</div><div class="line">          height: 100%;</div><div class="line">      &#125;</div><div class="line">      body &#123;</div><div class="line">          background: #fafafc url(https://s.yimg.com/nn/img/sad-panda-201402200631.png) 50% 50%;</div><div class="line">          background-size: cover;</div><div class="line">          height: 100%;</div><div class="line">          text-align: center;</div><div class="line">          font: 300 18px &quot;helvetica neue&quot;, helvetica, verdana, tahoma, arial, sans-serif;</div><div class="line">          margin: 0;</div><div class="line">      &#125;</div><div class="line">      table &#123;</div><div class="line">          height: 100%;</div><div class="line">          width: 100%;</div><div class="line">          table-layout: fixed;</div><div class="line">          border-collapse: collapse;</div><div class="line">          border-spacing: 0;</div><div class="line">          border: none;</div><div class="line">      &#125;</div><div class="line">      h1 &#123;</div><div class="line">          font-size: 42px;</div><div class="line">          font-weight: 400;</div><div class="line">          color: #400090;</div><div class="line">      &#125;</div><div class="line">      p &#123;</div><div class="line">          color: #1A1A1A;</div><div class="line">      &#125;</div><div class="line">      #message-1 &#123;</div><div class="line">          font-weight: bold;</div><div class="line">          margin: 0;</div><div class="line">      &#125;</div><div class="line">      #message-2 &#123;</div><div class="line">          display: inline-block;</div><div class="line">          *display: inline;</div><div class="line">          zoom: 1;</div><div class="line">          max-width: 17em;</div><div class="line">          _width: 17em;</div><div class="line">      &#125;</div><div class="line">      &lt;/style&gt;</div><div class="line">      &lt;script&gt;</div><div class="line">      &lt;/script&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  &lt;body&gt;</div><div class="line">  &lt;!-- status code : 400 --&gt;</div><div class="line">  &lt;!-- Bad Request: - --&gt;</div><div class="line">  &lt;!-- host machine: ir4.fp.bf1.yahoo.com --&gt;</div><div class="line">  &lt;!-- timestamp: 1489974172.000 --&gt;</div><div class="line">  &lt;!-- url: /--&gt;</div><div class="line">  &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    function buildUrl(url, parameters)&#123;</div><div class="line">      var qs = [];</div><div class="line">      for(var key in parameters) &#123;</div><div class="line">        var value = parameters[key];</div><div class="line">        qs.push(encodeURIComponent(key) + &quot;=&quot; + encodeURIComponent(value));</div><div class="line">      &#125;</div><div class="line">      url = url + &quot;?&quot; + qs.join(&apos;&amp;&apos;);</div><div class="line">      return url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function addEvent( obj, type, fn ) &#123;</div><div class="line">      if ( obj.attachEvent ) &#123;</div><div class="line">        obj[&apos;e&apos;+type+fn] = fn;</div><div class="line">        obj[type+fn] = function()&#123;obj[&apos;e&apos;+type+fn]( window.event );&#125;</div><div class="line">        obj.attachEvent( &apos;on&apos;+type, obj[type+fn] );</div><div class="line">      &#125; else</div><div class="line">        obj.addEventListener( type, fn, false );</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function generateBRBMarkup(site) &#123;</div><div class="line">      params.source = &apos;brb&apos;;</div><div class="line">      generateBeaconMarkup(params);</div><div class="line">      var englishHeader = &apos;Will be right back...&apos;;</div><div class="line">      var englishMessage1 = &apos;Thank you for your patience.&apos;;</div><div class="line">      var englishMessage2 = &apos;Our engineers are working quickly to resolve the issue.&apos;;</div><div class="line">      var defaultLogoStyle = &apos;&apos;;</div><div class="line">      var siteDataMap = &#123;</div><div class="line">        &apos;att.yahoo.com&apos;: &#123;</div><div class="line">          logo: &apos;https://s1.yimg.com/rz/d/att_en-US_f_p_bestfit_2x.png&apos;,</div><div class="line">          logoAlt: &apos;AT&amp;T&apos;,</div><div class="line">          logoStyle: defaultLogoStyle,</div><div class="line">          header: englishHeader,</div><div class="line">          message1: englishMessage1,</div><div class="line">          message2: englishMessage2</div><div class="line">        &#125;,</div><div class="line">        &apos;espanol.att.yahoo.com&apos;: &#123;</div><div class="line">          logo: &apos;https://s1.yimg.com/rz/d/att_es-US_f_p_bestfit_2x.png&apos;,</div><div class="line">          logoAlt: &apos;AT&amp;T En Vivo&apos;,</div><div class="line">          logoStyle: &apos;max-width:310px;&apos;,</div><div class="line">          header: &apos;Volvemos enseguida…&apos;,</div><div class="line">          message1: &apos;Gracias por tu paciencia.&apos;,</div><div class="line">          message2: &apos;Nuestros ingenieros están trabajando rápidamente para resolver el problema.&apos;</div><div class="line">        &#125;,</div><div class="line">        &apos;default&apos;: &#123;</div><div class="line">          logo: &apos;https://s.yimg.com/nn/img/yahoo-logo-201402200629.png&apos;,</div><div class="line">          logoAlt: &apos;Yahoo Logo&apos;,</div><div class="line">          logoStyle: defaultLogoStyle,</div><div class="line">          header: englishHeader,</div><div class="line">          message1: englishMessage1,</div><div class="line">          message2: englishMessage2</div><div class="line">        &#125;</div><div class="line">      &#125;;</div><div class="line"></div><div class="line">      var siteDetails = siteDataMap[&apos;default&apos;];</div><div class="line">      switch (site) &#123;</div><div class="line">        case &apos;espanol.att.yahoo.com&apos;:</div><div class="line">        case &apos;att.yahoo.com&apos;:</div><div class="line">          siteDetails = siteDataMap[site];</div><div class="line">          break;</div><div class="line">        default:</div><div class="line">          siteDetails = siteDataMap[&apos;default&apos;];</div><div class="line">          break;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      document.write(&apos;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;div id=&quot;content&quot;&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;img src=&quot;&apos; + siteDetails[&apos;logo&apos;] + &apos;&quot; alt=&quot;&apos; + siteDetails[&apos;logoAlt&apos;] + &apos;&quot; style=&quot;&apos; + siteDetails[&apos;logoStyle&apos;] + &apos;&quot;&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;h1 style=&quot;margin-top:20px;&quot;&gt;&apos; + siteDetails[&apos;header&apos;] + &apos;&lt;/h1&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;p id=&quot;message-1&quot;&gt;&apos; + siteDetails[&apos;message1&apos;] + &apos;&lt;/p&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;p id=&quot;message-2&quot;&gt;&apos; + siteDetails[&apos;message2&apos;] + &apos;&lt;/p&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;/div&gt;&apos;);</div><div class="line">      document.write(&apos;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function generateIframeMarkup(iframeUrl, params) &#123;</div><div class="line">      params.source = &apos;brbiframe&apos;;</div><div class="line">      generateBeaconMarkup(params);</div><div class="line">      document.write(&apos;&lt;iframe src=&quot;&apos; + iframeUrl + &apos;&quot; style=&quot;width:100%;height:100%;border:none;&quot; &gt;&apos;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    function generateBeaconMarkup(params) &#123;</div><div class="line">        document.write(&apos;&lt;img src=&quot;&apos; + buildUrl(&apos;//geo.yahoo.com/b&apos;, params) + &apos;&quot; style=&quot;display:none;&quot; width=&quot;0px&quot; height=&quot;0px&quot;/&gt;&apos;);</div><div class="line">        var beacon = new Image();</div><div class="line">        beacon.src = buildUrl(&apos;//bcn.fp.yahoo.com/p&apos;, params);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    var hostname = window.location.hostname;</div><div class="line">    var device = &apos;-&apos;;</div><div class="line">    var ynet = (&apos;-&apos; === &apos;1&apos;);</div><div class="line">    var brbHost = &apos;brb.yahoo.com&apos;;</div><div class="line">    var brbProto = &apos;https://&apos;;</div><div class="line">    var brbIframePath = &apos;/iframe.php&apos;;</div><div class="line">    var brbParams = &#123;</div><div class="line">      protocol: window.location.protocol,</div><div class="line">      host: hostname,</div><div class="line">      path: window.location.pathname,</div><div class="line">      device: device</div><div class="line">    &#125;;</div><div class="line">    var iframeUrl = buildUrl(brbProto + brbHost + brbIframePath, brbParams);</div><div class="line">    var iframeDisabled = !true;</div><div class="line">    var time = new Date().getTime();</div><div class="line">    var params = &#123;</div><div class="line">        s: &apos;1197757129&apos;,</div><div class="line">        t: time,</div><div class="line">        err_url: document.URL,</div><div class="line">        err: &apos;400&apos;,</div><div class="line">        test: &apos;-&apos;,</div><div class="line">        ats_host: &apos;ir4.fp.bf1.yahoo.com&apos;,</div><div class="line">        rid: &apos;-&apos;,</div><div class="line">        message: &apos;Bad Request: -&apos;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    if(ynet) &#123;</div><div class="line">        document.write(&apos;&lt;div style=&quot;height: 5px; background-color: red;&quot;&gt;&lt;/div&gt;&apos;);</div><div class="line">    &#125;</div><div class="line">    if (hostname.match(&apos;att.yahoo.com&apos;) || iframeDisabled) &#123;</div><div class="line">      generateBRBMarkup(hostname, params);</div><div class="line">    &#125; else &#123;</div><div class="line">      generateIframeMarkup(iframeUrl, params);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    addEvent(window, &quot;message&quot;, function(event) &#123;</div><div class="line">      if (event.origin !== (brbProto + brbHost)) &#123;</div><div class="line">        return;</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      if (event &amp;&amp; event.data &amp;&amp; event.data.url) &#123;</div><div class="line">        window.location.replace(event.data.url);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &lt;/script&gt;</div><div class="line">  &lt;noscript&gt;</div><div class="line">  &lt;table&gt;</div><div class="line">    &lt;tbody&gt;</div><div class="line">      &lt;tr&gt;</div><div class="line">        &lt;td&gt;</div><div class="line">          &lt;div id=&quot;englishContent&quot;&gt;</div><div class="line">            &lt;h1 style=&quot;margin-top:20px;&quot;&gt;Will be right back...&lt;/h1&gt;</div><div class="line">            &lt;p id=&quot;message-1&quot;&gt;Thank you for your patience.&lt;/p&gt;</div><div class="line">            &lt;p id=&quot;message-2&quot;&gt;Our engineers are working quickly to resolve the issue.&lt;/p&gt;</div><div class="line">          &lt;/div&gt;</div><div class="line">        &lt;/td&gt;</div><div class="line">      &lt;/tr&gt;</div><div class="line">    &lt;/tbody&gt;</div><div class="line">  &lt;/table&gt;</div><div class="line">  &lt;/noscript&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div><div class="line">Connection closed by foreign host.</div><div class="line">[root@ip-172-31-30-115 ec2-user]# kill %1</div><div class="line">[root@ip-172-31-30-115 ec2-user]# 26 packets captured</div><div class="line">26 packets received by filter</div><div class="line">0 packets dropped by kernel</div><div class="line"></div><div class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</div></pre></td></tr></table></figure>
<h3 id="Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo’s-authoritative-DNS-servers"><a href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo’s-authoritative-DNS-servers" class="headerlink" title="Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers."></a>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ec2-user]# tcpdump -t -n -r tcpdump.out udp port 53</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">IP 172.31.30.115.18721 &gt; 68.142.255.16.domain: 45641% [1au] A? www.yahoo.com. (42)</div><div class="line">IP 172.31.30.115.53735 &gt; 68.142.255.16.domain: 9034% [1au] AAAA? www.yahoo.com. (42)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.18721: 45641*- 1/4/3 CNAME fd-fp3.wg1.b.yahoo.com. (187)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.53735: 9034*- 1/4/3 CNAME fd-fp3.wg1.b.yahoo.com. (187)</div><div class="line">IP 172.31.30.115.17127 &gt; 68.180.130.15.domain: 64011% [1au] A? fd-fp3.wg1.b.yahoo.com. (51)</div><div class="line">IP 172.31.30.115.48161 &gt; 68.180.130.15.domain: 52861% [1au] AAAA? fd-fp3.wg1.b.yahoo.com. (51)</div><div class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.17127: 64011*- 2/0/1 A 98.139.180.149, A 98.139.183.24 (83)</div><div class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.48161: 52861*- 1/0/1 AAAA 2001:4998:58:c02::a9 (79)</div></pre></td></tr></table></figure>
<h3 id="Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo’s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection"><a href="#Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo’s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection" class="headerlink" title="Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection."></a>Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ec2-user]# tcpdump -n -r tcpdump.out tcp port 80</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">21:42:35.282439 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [S], seq 854216136, win 26883, options [mss 8961,sackOK,TS val 97995307 ecr 0,nop,wscale 7], length 0</div><div class="line">21:42:35.299558 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [S.], seq 225539872, ack 854216137, win 8192, options [mss 1460,nop,nop,sackOK,nop,wscale 8], length 0</div><div class="line">21:42:35.299596 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 1, win 211, length 0</div><div class="line">21:42:41.537040 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 1:17, ack 1, win 211, length 16</div><div class="line">21:42:41.555263 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 17, win 58, length 0</div><div class="line">21:42:50.064128 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 17:38, ack 1, win 211, length 21</div><div class="line">21:42:50.082376 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 38, win 58, length 0</div><div class="line">21:42:51.033280 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 38:40, ack 1, win 211, length 2</div><div class="line">21:42:51.051567 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 40, win 58, length 0</div><div class="line">21:42:51.053313 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [P.], seq 1:600, ack 40, win 58, length 599</div><div class="line">21:42:51.053331 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 600, win 220, length 0</div><div class="line">21:42:52.502208 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 40:42, ack 600, win 220, length 2</div><div class="line">21:42:52.521318 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], seq 600:3520, ack 42, win 58, length 2920</div><div class="line">21:42:52.521346 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 3520, win 266, length 0</div><div class="line">21:42:52.539662 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [FP.], seq 3520:7066, ack 42, win 58, length 3546</div><div class="line">21:42:52.539691 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 7067, win 321, length 0</div><div class="line">21:42:52.539912 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [F.], seq 42, ack 7067, win 321, length 0</div><div class="line">21:42:52.558114 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 43, win 58, length 0</div></pre></td></tr></table></figure>
<p>This is the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">21:42:35.282439 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [S], seq 854216136, win 26883, options [mss 8961,sackOK,TS val 97995307 ecr 0,nop,wscale 7], length 0</div><div class="line">21:42:35.299558 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [S.], seq 225539872, ack 854216137, win 8192, options [mss 1460,nop,nop,sackOK,nop,wscale 8], length 0</div><div class="line">21:42:35.299596 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 1, win 211, length 0</div></pre></td></tr></table></figure></p>
<p>The packets that are being sent back :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">21:42:41.537040 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 1:17, ack 1, win 211, length 16</div><div class="line">21:42:41.555263 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 17, win 58, length 0</div><div class="line">21:42:50.064128 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 17:38, ack 1, win 211, length 21</div><div class="line">21:42:50.082376 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 38, win 58, length 0</div><div class="line">21:42:51.033280 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 38:40, ack 1, win 211, length 2</div><div class="line">21:42:51.051567 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 40, win 58, length 0</div></pre></td></tr></table></figure></p>
<p>and forth:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">21:42:51.053313 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [P.], seq 1:600, ack 40, win 58, length 599</div><div class="line">21:42:51.053331 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 600, win 220, length 0</div><div class="line">21:42:52.502208 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [P.], seq 40:42, ack 600, win 220, length 2</div><div class="line">21:42:52.521318 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], seq 600:3520, ack 42, win 58, length 2920</div><div class="line">21:42:52.521346 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 3520, win 266, length 0</div></pre></td></tr></table></figure></p>
<p>and finally the closing of the connection:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">21:42:52.539662 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [FP.], seq 3520:7066, ack 42, win 58, length 3546</div><div class="line">21:42:52.539691 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [.], ack 7067, win 321, length 0</div><div class="line">21:42:52.539912 IP 172.31.30.115.54256 &gt; 98.139.180.149.http: Flags [F.], seq 42, ack 7067, win 321, length 0</div><div class="line">21:42:52.558114 IP 98.139.180.149.http &gt; 172.31.30.115.54256: Flags [.], ack 43, win 58, length 0</div></pre></td></tr></table></figure></p>
<h2 id="Second-scenarios"><a href="#Second-scenarios" class="headerlink" title="Second scenarios"></a>Second scenarios</h2><h3 id="Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios"><a href="#Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios" class="headerlink" title="Install tcpdump and telnet on client (the same step as first scenarios.)"></a>Install tcpdump and telnet on client (the same step as first scenarios.)</h3><h3 id="Set-tcpdump-to-listen"><a href="#Set-tcpdump-to-listen" class="headerlink" title="Set tcpdump to listen"></a>Set tcpdump to listen</h3><p>On server:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ~]# tcpdump -w tcpdump.out port not 22 &amp;</div><div class="line">[1] 19713</div><div class="line">[root@ip-172-31-30-115 ~]# tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</div><div class="line">arp -d -a</div><div class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</div></pre></td></tr></table></figure></p>
<p>On client:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-23-114 ~]# tcpdump -w tcpdump.out port not 22 &amp;</div><div class="line">[1] 18272</div><div class="line">[root@ip-172-31-23-114 ~]# tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</div><div class="line">arp -d -a</div><div class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</div></pre></td></tr></table></figure></p>
<h3 id="Run-telnet"><a href="#Run-telnet" class="headerlink" title="Run telnet"></a>Run telnet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-23-114 ~]# telnet www.tumblr.com 80</div><div class="line">Trying 69.147.82.57...</div><div class="line">Connected to www.tumblr.com.</div><div class="line">Escape character is &apos;^]&apos;.</div><div class="line">GET / HTTP/1.0</div><div class="line"></div><div class="line">HTTP/1.0 400 Host Header Required</div><div class="line">Date: Sun, 19 Mar 2017 23:38:52 GMT</div><div class="line">Via: http/1.1 e4.ycpi.nya.yahoo.com (ApacheTrafficServer [c s f ])</div><div class="line">Server: ATS</div><div class="line">Cache-Control: no-store</div><div class="line">Content-Type: text/html</div><div class="line">Content-Language: en</div><div class="line">Content-Length: 2810</div><div class="line"></div><div class="line">&lt;!DOCTYPE html&gt;</div><div class="line">&lt;html lang=&quot;en-us&quot;&gt;&lt;head&gt;</div><div class="line">&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;</div><div class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</div><div class="line">    &lt;title&gt;Yahoo&lt;/title&gt;</div><div class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimal-ui&quot;&gt;</div><div class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge,chrome=1&quot;&gt;</div><div class="line">    &lt;style&gt;</div><div class="line">html &#123;</div><div class="line">    height: 100%;</div><div class="line">&#125;</div><div class="line">body &#123;</div><div class="line">    background: #fafafc url(https://s.yimg.com/nn/img/sad-panda-201402200631.png) 50% 50%;</div><div class="line">    background-size: cover;</div><div class="line">    height: 100%;</div><div class="line">    text-align: center;</div><div class="line">    font: 300 18px &quot;helvetica neue&quot;, helvetica, verdana, tahoma, arial, sans-serif;</div><div class="line">&#125;</div><div class="line">table &#123;</div><div class="line">    height: 100%;</div><div class="line">    width: 100%;</div><div class="line">    table-layout: fixed;</div><div class="line">    border-collapse: collapse;</div><div class="line">    border-spacing: 0;</div><div class="line">    border: none;</div><div class="line">&#125;</div><div class="line">h1 &#123;</div><div class="line">    font-size: 42px;</div><div class="line">    font-weight: 400;</div><div class="line">    color: #400090;</div><div class="line">&#125;</div><div class="line">p &#123;</div><div class="line">    color: #1A1A1A;</div><div class="line">&#125;</div><div class="line">#message-1 &#123;</div><div class="line">    font-weight: bold;</div><div class="line">    margin: 0;</div><div class="line">&#125;</div><div class="line">#message-2 &#123;</div><div class="line">    display: inline-block;</div><div class="line">    *display: inline;</div><div class="line">    zoom: 1;</div><div class="line">    max-width: 17em;</div><div class="line">    _width: 17em;</div><div class="line">&#125;</div><div class="line">#spanishContent &#123;</div><div class="line">    display: none;</div><div class="line">&#125;</div><div class="line">    &lt;/style&gt;</div><div class="line">&lt;script&gt;</div><div class="line">  document.write(&apos;&lt;img src=&quot;//geo.yahoo.com/b?s=1197757129&amp;t=&apos;+new Date().getTime()+&apos;&amp;err_url=&apos;+encodeURIComponent(document.URL)+&apos;&amp;err=400&amp;test=&apos;+encodeURIComponent(&apos;-&apos;)+&apos;&quot; width=&quot;0px&quot; height=&quot;0px&quot;/&gt;&apos;);</div><div class="line">&lt;/script&gt;</div><div class="line">&lt;/head&gt;</div><div class="line">&lt;body&gt;</div><div class="line">&lt;!-- status code : 400 --&gt;</div><div class="line">&lt;!-- Host Header Required --&gt;</div><div class="line">&lt;!-- host machine: e4.ycpi.nya.yahoo.com --&gt;</div><div class="line">&lt;!-- timestamp: 1489966732.000 --&gt;</div><div class="line">&lt;!-- url: http:///--&gt;</div><div class="line">&lt;table&gt;</div><div class="line">&lt;tbody&gt;&lt;tr&gt;</div><div class="line">    &lt;td&gt;</div><div class="line">    &lt;div id=&quot;englishContent&quot;&gt;</div><div class="line">        &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">        if (window.location.hostname==&apos;att.yahoo.com&apos;)&#123;</div><div class="line">            document.write(&apos;&lt;img src=&quot;https://s1.yimg.com/rz/d/att_en-US_f_p_bestfit_2x.png&quot; alt=&quot;AT&amp;T&quot;&gt;&apos;);</div><div class="line">        &#125;else&#123;</div><div class="line">            document.write(&apos;&lt;img src=&quot;https://s.yimg.com/nn/img/yahoo-logo-201402200629.png&quot; alt=&quot;Yahoo Logo&quot;&gt;&apos;);</div><div class="line">        &#125;    </div><div class="line">        &lt;/script&gt; </div><div class="line">        &lt;h1 style=&quot;margin-top:20px;&quot;&gt;Will be right back...&lt;/h1&gt;</div><div class="line">        &lt;p id=&quot;message-1&quot;&gt;Thank you for your patience.&lt;/p&gt;</div><div class="line">        &lt;p id=&quot;message-2&quot;&gt;Our engineers are working quickly to resolve the issue.&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;div id=&quot;spanishContent&quot;&gt; </div><div class="line">        &lt;img src=&quot;https://s1.yimg.com/rz/d/att_es-US_f_p_bestfit_2x.png&quot; alt=&quot;AT&amp;T En Vivo&quot; style=&quot;max-width:310px&quot;&gt;</div><div class="line">        &lt;h1 style=&quot;margin-top:20px;&quot;&gt;Volvemos enseguida…&lt;/h1&gt;</div><div class="line">        &lt;p id=&quot;message-1&quot;&gt;Gracias por tu paciencia.&lt;/p&gt;</div><div class="line">        &lt;p id=&quot;message-2&quot;&gt;Nuestros ingenieros están trabajando rápidamente para resolver el problema.&lt;/p&gt;</div><div class="line">    &lt;/div&gt;</div><div class="line">    &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">    if (window.location.hostname==&apos;espanol.att.yahoo.com&apos;)&#123;</div><div class="line">        document.getElementById(&apos;englishContent&apos;).style.display = &apos;none&apos;;</div><div class="line">        document.getElementById(&apos;spanishContent&apos;).style.display = &apos;block&apos;;</div><div class="line">    &#125;   </div><div class="line">    &lt;/script&gt;</div><div class="line">    &lt;/td&gt;</div><div class="line">&lt;/tr&gt;</div><div class="line">&lt;/tbody&gt;&lt;/table&gt;</div><div class="line"></div><div class="line"></div><div class="line">&lt;/body&gt;&lt;/html&gt;</div><div class="line">Connection closed by foreign host.</div><div class="line">[root@ip-172-31-23-114 ~]# kill %1</div><div class="line">[root@ip-172-31-23-114 ~]# 33 packets captured</div><div class="line">33 packets received by filter</div><div class="line">0 packets dropped by kernel</div><div class="line"></div><div class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</div></pre></td></tr></table></figure>
<h3 id="Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server"><a href="#Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server" class="headerlink" title="Track down the packets in tcpdump referring to the DNS query from your client host to DNS server."></a>Track down the packets in tcpdump referring to the DNS query from your client host to DNS server.</h3><p>On client:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-23-114 ~]# tcpdump -t -n -r tcpdump.out udp port 53</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">IP 172.31.23.114.50439 &gt; 54.91.19.43.domain: 57805+ PTR? 1.16.31.172.in-addr.arpa. (42)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.50439: 57805 NXDomain* 0/1/0 (77)</div><div class="line">IP 172.31.23.114.60063 &gt; 54.91.19.43.domain: 42152+ PTR? 218.24.13.126.in-addr.arpa. (44)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.60063: 42152 1/2/0 PTR softbank126013024218.bbtec.net. (128)</div><div class="line">IP 172.31.23.114.48371 &gt; 54.91.19.43.domain: 58570+ A? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.48371: 58570 1/2/2 A 126.13.24.218 (136)</div><div class="line">IP 172.31.23.114.40529 &gt; 54.91.19.43.domain: 30948+ A? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 172.31.23.114.40529 &gt; 54.91.19.43.domain: 36622+ AAAA? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.40529: 30948 1/2/2 A 126.13.24.218 (136)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.40529: 36622 0/1/0 (94)</div><div class="line">IP 172.31.23.114.32918 &gt; 54.91.19.43.domain: 35896+ A? www.tumblr.com. (32)</div><div class="line">IP 172.31.23.114.32918 &gt; 54.91.19.43.domain: 2913+ AAAA? www.tumblr.com. (32)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.32918: 35896 5/4/2 CNAME e2p-v4.gycs.b.yahoodns.net., A 69.147.82.57, A 69.147.92.13, A 69.147.82.56, A 69.147.92.14 (257)</div><div class="line">IP 54.91.19.43.domain &gt; 172.31.23.114.32918: 2913 1/1/0 CNAME e2p-v4.gycs.b.yahoodns.net. (139)</div></pre></td></tr></table></figure></p>
<h3 id="Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr’s-authoritative-DNS-servers"><a href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr’s-authoritative-DNS-servers" class="headerlink" title="Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers."></a>Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</h3><p>On server:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 ~]# kill %1</div><div class="line">[root@ip-172-31-30-115 ~]# 124 packets captured</div><div class="line">124 packets received by filter</div><div class="line">0 packets dropped by kernel</div><div class="line"></div><div class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</div><div class="line">[root@ip-172-31-30-115 ~]# tcpdump -t -n -r tcpdump.out udp port 53</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">IP 54.242.90.155.50439 &gt; 172.31.30.115.domain: 57805+ PTR? 1.16.31.172.in-addr.arpa. (42)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.50439: 57805 NXDomain* 0/1/0 (77)</div><div class="line">IP 54.242.90.155.60063 &gt; 172.31.30.115.domain: 42152+ PTR? 218.24.13.126.in-addr.arpa. (44)</div><div class="line">IP 172.31.30.115.12672 &gt; 193.0.9.1.domain: 25355% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</div><div class="line">IP 193.0.9.1.domain &gt; 172.31.30.115.12672: 25355- 0/7/1 (377)</div><div class="line">IP 172.31.30.115.9590 &gt; 202.12.28.131.domain: 893% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</div><div class="line">IP 172.31.30.115.16018 &gt; 192.12.94.30.domain: 4896% [1au] A? ns001.bbtec.net. (44)</div><div class="line">IP 172.31.30.115.28464 &gt; 192.12.94.30.domain: 35378% [1au] AAAA? ns001.bbtec.net. (44)</div><div class="line">IP 172.31.30.115.39371 &gt; 192.12.94.30.domain: 28698% [1au] A? ns002.bbtec.net. (44)</div><div class="line">IP 172.31.30.115.64953 &gt; 192.12.94.30.domain: 61674% [1au] AAAA? ns002.bbtec.net. (44)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.16018: 4896- 0/6/3 (601)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.28464: 35378- 0/6/3 (601)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.39371: 28698- 0/6/3 (601)</div><div class="line">IP 172.31.30.115.64318 &gt; 218.176.253.105.domain: 44419% [1au] A? ns001.bbtec.net. (44)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.64953: 61674- 0/6/3 (601)</div><div class="line">IP 172.31.30.115.64670 &gt; 218.176.253.105.domain: 43269% [1au] AAAA? ns001.bbtec.net. (44)</div><div class="line">IP 172.31.30.115.15986 &gt; 218.176.253.105.domain: 49175% [1au] A? ns002.bbtec.net. (44)</div><div class="line">IP 172.31.30.115.12481 &gt; 218.176.253.105.domain: 30143% [1au] AAAA? ns002.bbtec.net. (44)</div><div class="line">IP 202.12.28.131.domain &gt; 172.31.30.115.9590: 893- 0/2/1 (104)</div><div class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.64670: 43269*- 0/1/1 (90)</div><div class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.12481: 30143*- 0/1/1 (90)</div><div class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.15986: 49175*- 1/2/3 A 218.176.253.104 (132)</div><div class="line">IP 172.31.30.115.12796 &gt; 218.176.253.104.domain: 1893% [1au] PTR? 218.24.13.126.in-addr.arpa. (55)</div><div class="line">IP 218.176.253.105.domain &gt; 172.31.30.115.64318: 44419*- 1/2/3 A 218.176.253.72 (132)</div><div class="line">IP 218.176.253.104.domain &gt; 172.31.30.115.12796: 1893*- 1/2/1 PTR softbank126013024218.bbtec.net. (139)</div><div class="line">IP 172.31.30.115.15402 &gt; 200.10.60.53.domain: 35634% [1au] DS? 126.in-addr.arpa. (45)</div><div class="line">IP 200.10.60.53.domain &gt; 172.31.30.115.15402: 35634*- 0/4/1 (501)</div><div class="line">IP 172.31.30.115.29985 &gt; 199.212.0.73.domain: 54806% [1au] DNSKEY? in-addr.arpa. (41)</div><div class="line">IP 199.212.0.73.domain &gt; 172.31.30.115.29985: 54806*- 5/0/1 DNSKEY, DNSKEY, DNSKEY, RRSIG, RRSIG (1344)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.60063: 42152 1/2/0 PTR softbank126013024218.bbtec.net. (128)</div><div class="line">IP 54.242.90.155.48371 &gt; 172.31.30.115.domain: 58570+ A? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 172.31.30.115.23886 &gt; 218.176.253.73.domain: 64646% [1au] A? softbank126013024218.bbtec.net. (59)</div><div class="line">IP 218.176.253.73.domain &gt; 172.31.30.115.23886: 64646*- 1/2/3 A 126.13.24.218 (147)</div><div class="line">IP 172.31.30.115.28358 &gt; 192.54.112.30.domain: 41306% [1au] DS? bbtec.net. (38)</div><div class="line">IP 192.54.112.30.domain &gt; 172.31.30.115.28358: 41306*- 0/6/1 (759)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.48371: 58570 1/2/2 A 126.13.24.218 (136)</div><div class="line">IP 54.242.90.155.40529 &gt; 172.31.30.115.domain: 30948+ A? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 54.242.90.155.40529 &gt; 172.31.30.115.domain: 36622+ AAAA? softbank126013024218.bbtec.net. (48)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.40529: 30948 1/2/2 A 126.13.24.218 (136)</div><div class="line">IP 172.31.30.115.61458 &gt; 218.176.253.73.domain: 11958% [1au] AAAA? softbank126013024218.bbtec.net. (59)</div><div class="line">IP 218.176.253.73.domain &gt; 172.31.30.115.61458: 11958*- 0/1/1 (105)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.40529: 36622 0/1/0 (94)</div><div class="line">IP 54.242.90.155.32918 &gt; 172.31.30.115.domain: 35896+ A? www.tumblr.com. (32)</div><div class="line">IP 54.242.90.155.32918 &gt; 172.31.30.115.domain: 2913+ AAAA? www.tumblr.com. (32)</div><div class="line">IP 172.31.30.115.50312 &gt; 192.5.6.30.domain: 15102% [1au] A? www.tumblr.com. (43)</div><div class="line">IP 172.31.30.115.55078 &gt; 192.5.6.30.domain: 24281% [1au] AAAA? www.tumblr.com. (43)</div><div class="line">IP 192.5.6.30.domain &gt; 172.31.30.115.50312: 15102- 0/14/15 (1000)</div><div class="line">IP 192.5.6.30.domain &gt; 172.31.30.115.55078: 24281- 0/14/15 (1000)</div><div class="line">IP 172.31.30.115.54183 &gt; 68.142.255.16.domain: 27760% [1au] A? www.tumblr.com. (43)</div><div class="line">IP 172.31.30.115.42766 &gt; 68.142.255.16.domain: 50340% [1au] AAAA? www.tumblr.com. (43)</div><div class="line">IP 172.31.30.115.20720 &gt; 192.12.94.30.domain: 56843% [1au] A? ns1.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.31015 &gt; 192.12.94.30.domain: 59860% [1au] AAAA? ns1.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.44619 &gt; 192.12.94.30.domain: 48475% [1au] A? ns2.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.29788 &gt; 192.12.94.30.domain: 9652% [1au] AAAA? ns2.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.57147 &gt; 192.12.94.30.domain: 62071% [1au] A? ns3.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.28255 &gt; 192.12.94.30.domain: 63541% [1au] AAAA? ns3.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.8489 &gt; 192.12.94.30.domain: 48551% [1au] A? ns4.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.55613 &gt; 192.12.94.30.domain: 31935% [1au] AAAA? ns4.p03.dynect.net. (47)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.54183: 27760*- 1/4/3 CNAME e2p-v4.gycs.b.yahoodns.net. (204)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.42766: 50340*- 1/4/3 CNAME e2p-v4.gycs.b.yahoodns.net. (204)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.20720: 56843- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.31015: 59860- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.44619: 48475- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.29788: 9652- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.57147: 62071- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.28255: 63541- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.8489: 48551- 0/11/13 (933)</div><div class="line">IP 192.12.94.30.domain &gt; 172.31.30.115.55613: 31935- 0/11/13 (933)</div><div class="line">IP 172.31.30.115.59179 &gt; 204.13.250.136.domain: 32061% [1au] A? ns2.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.10967 &gt; 204.13.250.136.domain: 15199% [1au] AAAA? ns2.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.12591 &gt; 204.13.250.136.domain: 46251% [1au] A? ns3.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.23689 &gt; 204.13.250.136.domain: 49237% [1au] AAAA? ns3.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.20181 &gt; 204.13.250.136.domain: 23229% [1au] A? ns4.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.56792 &gt; 204.13.250.136.domain: 59367% [1au] AAAA? ns4.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.29332 &gt; 192.33.14.30.domain: 41065% [1au] DS? tumblr.com. (39)</div><div class="line">IP 172.31.30.115.60180 &gt; 204.13.250.136.domain: 12063% [1au] A? ns1.p03.dynect.net. (47)</div><div class="line">IP 172.31.30.115.59836 &gt; 204.13.250.136.domain: 47624% [1au] AAAA? ns1.p03.dynect.net. (47)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.12591: 46251*- 1/7/1 A 208.78.71.3 (212)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.10967: 15199*- 0/1/1 (131)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.59179: 32061*- 1/7/1 A 204.13.250.3 (212)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.59836: 47624*- 1/7/1 AAAA 2001:500:90:1::3 (224)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.56792: 59367*- 0/1/1 (131)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.20181: 23229*- 1/7/1 A 204.13.251.3 (212)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.23689: 49237*- 1/7/1 AAAA 2001:500:94:1::3 (224)</div><div class="line">IP 204.13.250.136.domain &gt; 172.31.30.115.60180: 12063*- 1/7/1 A 208.78.70.3 (212)</div><div class="line">IP 192.33.14.30.domain &gt; 172.31.30.115.29332: 41065*- 0/6/1 (760)</div><div class="line">IP 172.31.30.115.45512 &gt; 192.35.51.30.domain: 2908% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 172.31.30.115.48965 &gt; 192.35.51.30.domain: 16552% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.45512: 2908- 0/9/9 (803)</div><div class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.48965: 16552- 0/9/9 (803)</div><div class="line">IP 172.31.30.115.20105 &gt; 68.142.255.16.domain: 16315% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 172.31.30.115.29503 &gt; 68.142.255.16.domain: 50107% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.20105: 16315- 0/4/3 (179)</div><div class="line">IP 68.142.255.16.domain &gt; 172.31.30.115.29503: 50107- 0/4/3 (179)</div><div class="line">IP 172.31.30.115.44871 &gt; 68.180.130.15.domain: 45208% [1au] AAAA? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 172.31.30.115.11781 &gt; 68.180.130.15.domain: 48190% [1au] A? e2p-v4.gycs.b.yahoodns.net. (55)</div><div class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.44871: 45208*- 0/1/1 (125)</div><div class="line">IP 68.180.130.15.domain &gt; 172.31.30.115.11781: 48190*- 4/0/1 A 69.147.92.14, A 69.147.82.57, A 69.147.82.56, A 69.147.92.13 (119)</div><div class="line">IP 172.31.30.115.59783 &gt; 192.35.51.30.domain: 13560% [1au] DS? yahoodns.net. (41)</div><div class="line">IP 192.35.51.30.domain &gt; 172.31.30.115.59783: 13560*- 0/6/1 (762)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.32918: 35896 5/4/2 CNAME e2p-v4.gycs.b.yahoodns.net., A 69.147.82.57, A 69.147.92.13, A 69.147.82.56, A 69.147.92.14 (257)</div><div class="line">IP 172.31.30.115.domain &gt; 54.242.90.155.32918: 2913 1/1/0 CNAME e2p-v4.gycs.b.yahoodns.net. (139)</div></pre></td></tr></table></figure>
<p>I found before the ‘telnet’ running in the client, my client sent some PTR requests for ‘1.16.31.172.in-addr.arpa’ and ‘218.24.13.126.in-addr.arpa’. The former looks loke the AWS internal IP address(private address).And my client also ask address for ‘softbank126013024218.bbtec.net’. These behaviors make me feel puzzled.<br>My client sent request to server for ‘www.tumblr.com’. Then server will search its CNAME and ip address, and return the result to my client.</p>
<h2 id="Third-scenarios"><a href="#Third-scenarios" class="headerlink" title="Third scenarios"></a>Third scenarios</h2><p>For example, I perform a reverse host look up for ‘104.244.42.193’ which not yet in my DNS server’s cache.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 t]# tcpdump -w tcpdump.out port not 22 &amp;</div><div class="line">[1] 19863</div><div class="line">[root@ip-172-31-30-115 t]# tcpdump: listening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes</div><div class="line">arp -d -a</div><div class="line">gateway (172.31.16.1) at 0e:8a:cb:2d:0b:70 [ether] on eth0</div><div class="line">[root@ip-172-31-30-115 t]# dig -x 104.244.42.193</div><div class="line"></div><div class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-38.el7_3.2 &lt;&lt;&gt;&gt; -x 104.244.42.193</div><div class="line">;; global options: +cmd</div><div class="line">;; Got answer:</div><div class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: SERVFAIL, id: 14873</div><div class="line">;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1</div><div class="line"></div><div class="line">;; OPT PSEUDOSECTION:</div><div class="line">; EDNS: version: 0, flags:; udp: 4096</div><div class="line">;; QUESTION SECTION:</div><div class="line">;193.42.244.104.in-addr.arpa.	IN	PTR</div><div class="line"></div><div class="line">;; Query time: 20 msec</div><div class="line">;; SERVER: 127.0.0.1#53(127.0.0.1)</div><div class="line">;; WHEN: Sun Mar 19 20:45:42 EDT 2017</div><div class="line">;; MSG SIZE  rcvd: 56</div><div class="line"></div><div class="line">[root@ip-172-31-30-115 t]# kill %1</div><div class="line">[root@ip-172-31-30-115 t]# 30 packets captured</div><div class="line">30 packets received by filter</div><div class="line">0 packets dropped by kernel</div><div class="line"></div><div class="line">[1]+  Done                    tcpdump -w tcpdump.out port not 22</div></pre></td></tr></table></figure>
<p>Result:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 t]# tcpdump -t -n -r tcpdump.out udp port 53</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">IP 172.31.30.115.13797 &gt; 199.253.183.183.domain: 18802% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 199.253.183.183.domain &gt; 172.31.30.115.13797: 18802- 0/8/1 (387)</div><div class="line">IP 172.31.30.115.10452 &gt; 199.180.180.63.domain: 62185% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 199.180.180.63.domain &gt; 172.31.30.115.10452: 62185- 0/6/1 (363)</div><div class="line">IP 172.31.30.115.44763 &gt; 162.88.61.21.domain: 55611% [1au] A? ns1.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.36069 &gt; 162.88.61.21.domain: 34433% [1au] AAAA? ns1.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.atmtcp &gt; 162.88.61.21.domain: 27190% [1au] A? ns2.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.56824 &gt; 162.88.61.21.domain: 1127% [1au] AAAA? ns2.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.44520 &gt; 162.88.61.21.domain: 22087% [1au] A? ns3.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.9172 &gt; 162.88.61.21.domain: 9046% [1au] AAAA? ns3.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.8847 &gt; 162.88.61.21.domain: 31946% [1au] A? ns4.p34.dynect.net. (47)</div><div class="line">IP 172.31.30.115.16122 &gt; 162.88.61.21.domain: 60963% [1au] AAAA? ns4.p34.dynect.net. (47)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.atmtcp: 27190*- 1/0/1 A 204.13.250.34 (63)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.56824: 1127*- 0/1/1 (131)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.44520: 22087*- 1/0/1 A 208.78.71.34 (63)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.9172: 9046*- 1/0/1 AAAA 2001:500:94:1::34 (75)</div><div class="line">IP 172.31.30.115.30710 &gt; 204.13.250.34.domain: 35918% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.44763: 55611*- 1/0/1 A 208.78.70.34 (63)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.16122: 60963*- 0/1/1 (131)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.36069: 34433*- 1/0/1 AAAA 2001:500:90:1::34 (75)</div><div class="line">IP 162.88.61.21.domain &gt; 172.31.30.115.8847: 31946*- 1/0/1 A 204.13.251.34 (63)</div><div class="line">IP 204.13.250.34.domain &gt; 172.31.30.115.30710: 35918 Refused- 0/0/1 (56)</div><div class="line">IP 172.31.30.115.38732 &gt; 208.78.71.34.domain: 17860% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 208.78.71.34.domain &gt; 172.31.30.115.38732: 17860 Refused- 0/0/1 (56)</div><div class="line">IP 172.31.30.115.31531 &gt; 204.13.251.34.domain: 16321% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 204.13.251.34.domain &gt; 172.31.30.115.31531: 16321 Refused- 0/0/1 (56)</div><div class="line">IP 172.31.30.115.53208 &gt; 208.78.70.34.domain: 33024% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP 208.78.70.34.domain &gt; 172.31.30.115.53208: 33024 Refused- 0/0/1 (56)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">[root@ip-172-31-30-115 t]# tcpdump -t  -r tcpdump.out udp port 53</div><div class="line">reading from file tcpdump.out, link-type EN10MB (Ethernet)</div><div class="line">IP ip-172-31-30-115.ec2.internal.13797 &gt; b.in-addr-servers.arpa.domain: 18802% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP b.in-addr-servers.arpa.domain &gt; ip-172-31-30-115.ec2.internal.13797: 18802- 0/8/1 (387)</div><div class="line">IP ip-172-31-30-115.ec2.internal.10452 &gt; r.arin.net.domain: 62185% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP r.arin.net.domain &gt; ip-172-31-30-115.ec2.internal.10452: 62185- 0/6/1 (363)</div><div class="line">IP ip-172-31-30-115.ec2.internal.44763 &gt; ns6.dynamicnetworkservices.net.domain: 55611% [1au] A? ns1.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.36069 &gt; ns6.dynamicnetworkservices.net.domain: 34433% [1au] AAAA? ns1.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.atmtcp &gt; ns6.dynamicnetworkservices.net.domain: 27190% [1au] A? ns2.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.56824 &gt; ns6.dynamicnetworkservices.net.domain: 1127% [1au] AAAA? ns2.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.44520 &gt; ns6.dynamicnetworkservices.net.domain: 22087% [1au] A? ns3.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.9172 &gt; ns6.dynamicnetworkservices.net.domain: 9046% [1au] AAAA? ns3.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.8847 &gt; ns6.dynamicnetworkservices.net.domain: 31946% [1au] A? ns4.p34.dynect.net. (47)</div><div class="line">IP ip-172-31-30-115.ec2.internal.16122 &gt; ns6.dynamicnetworkservices.net.domain: 60963% [1au] AAAA? ns4.p34.dynect.net. (47)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.atmtcp: 27190*- 1/0/1 A 204.13.250.34 (63)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.56824: 1127*- 0/1/1 (131)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.44520: 22087*- 1/0/1 A 208.78.71.34 (63)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.9172: 9046*- 1/0/1 AAAA 2001:500:94:1::34 (75)</div><div class="line">IP ip-172-31-30-115.ec2.internal.30710 &gt; ns2.p34.dynect.net.domain: 35918% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.44763: 55611*- 1/0/1 A 208.78.70.34 (63)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.16122: 60963*- 0/1/1 (131)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.36069: 34433*- 1/0/1 AAAA 2001:500:90:1::34 (75)</div><div class="line">IP ns6.dynamicnetworkservices.net.domain &gt; ip-172-31-30-115.ec2.internal.8847: 31946*- 1/0/1 A 204.13.251.34 (63)</div><div class="line">IP ns2.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.30710: 35918 Refused- 0/0/1 (56)</div><div class="line">IP ip-172-31-30-115.ec2.internal.38732 &gt; ns3.p34.dynect.net.domain: 17860% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP ns3.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.38732: 17860 Refused- 0/0/1 (56)</div><div class="line">IP ip-172-31-30-115.ec2.internal.31531 &gt; ns4.p34.dynect.net.domain: 16321% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP ns4.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.31531: 16321 Refused- 0/0/1 (56)</div><div class="line">IP ip-172-31-30-115.ec2.internal.53208 &gt; ns1.p34.dynect.net.domain: 33024% [1au] PTR? 193.42.244.104.in-addr.arpa. (56)</div><div class="line">IP ns1.p34.dynect.net.domain &gt; ip-172-31-30-115.ec2.internal.53208: 33024 Refused- 0/0/1 (56)</div></pre></td></tr></table></figure>
<p>My server communicate with these name servers:</p>
<p>199.253.183.183            b.in-addr-servers.arpa<br>199.180.180.63            r.arin.net<br>162.88.61.21            ns6.dynamicnetworkservices     </p>
<p>These servers aren’t the root servers. And I also use ‘whois’ try to find their operators, but there isn’t any message about them.</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>Title:</span><a href="/2017/08/16/tcpdump-1-DNS/">Tcpdump(1) DNS</a></p>
        <p><span>Author:</span><a href="/" title="Back to Homepage">Ankai Liang</a></p>
        <p><span>Created:</span>2017-08-16, 23:27:53</p>
        <p><span>Updated:</span>2017-08-17, 03:33:24</p>
        <p>
            <span>Full URL:</span><a class="post-url" href="/2017/08/16/tcpdump-1-DNS/" title="Tcpdump(1) DNS">https://AnkaiLiang.github.io/2017/08/16/tcpdump-1-DNS/</a>
            <span class="copy-path" data-clipboard-text="From https://AnkaiLiang.github.io/2017/08/16/tcpdump-1-DNS/　　By Ankai Liang" title="Copy Article&#39;s Link &amp; Author"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>License:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"CC BY-NC-SA 4.0"</a> Keep Link &amp; Author if Distribute.
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2017/08/17/afewmore-A-tool-of-ec2-how-to-write-a-shell-tool/">
                    Afewmore
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2017/08/16/Using-Manages-packages-in-Linux/">
                    Using Manages Packages in Linux
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Description"><span class="toc-number">1.</span> <span class="toc-text">Description</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Objective"><span class="toc-number">1.1.</span> <span class="toc-text">Objective</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OS-Instances"><span class="toc-number">1.2.</span> <span class="toc-text">OS Instances</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS-server-setup"><span class="toc-number">1.2.1.</span> <span class="toc-text">DNS server setup</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Content"><span class="toc-number">2.</span> <span class="toc-text">Content</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Set-up-a-caching-name-server"><span class="toc-number">2.1.</span> <span class="toc-text">Set up a caching name server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Create-a-instance-of-Red-Hat"><span class="toc-number">2.2.</span> <span class="toc-text">Create a instance of Red Hat.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install-package-bind-bind-utils-and-caching-nameserver"><span class="toc-number">2.3.</span> <span class="toc-text">Install package bind, bind-utils and caching-nameserver.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modify-the-file-‘-etc-named-conf’"><span class="toc-number">2.4.</span> <span class="toc-text">Modify the file ‘/etc/named.conf’</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Look-the-file-‘named-ca’"><span class="toc-number">2.5.</span> <span class="toc-text">Look the file ‘named.ca’:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modify-the-file-‘etc-resolv-conf’"><span class="toc-number">2.6.</span> <span class="toc-text">Modify the file ‘etc/resolv.conf’:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Deploy-the-Cache-only-DNS-server-within-chroot-environment"><span class="toc-number">2.7.</span> <span class="toc-text">Deploy the Cache-only DNS server within chroot environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Start-the-named-server"><span class="toc-number">2.8.</span> <span class="toc-text">Start the named server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Configured-the-client"><span class="toc-number">2.9.</span> <span class="toc-text">Configured the client</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-an-instance-as-our-client"><span class="toc-number">2.9.1.</span> <span class="toc-text">Create an instance as our client</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcpdump-exercises"><span class="toc-number">2.10.</span> <span class="toc-text">tcpdump exercises</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#First-scenario"><span class="toc-number">2.10.1.</span> <span class="toc-text">First scenario</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Install-telnet-and-tcpdump"><span class="toc-number">2.10.1.1.</span> <span class="toc-text">Install telnet and tcpdump</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-tcpdump-to-record-package-information"><span class="toc-number">2.10.2.</span> <span class="toc-text">Set tcpdump to record package information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Yahoo’s-authoritative-DNS-servers"><span class="toc-number">2.10.3.</span> <span class="toc-text">Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Yahoo’s authoritative DNS servers.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Identify-the-3-way-handshake-that-initiates-the-connection-from-your-DNS-server-to-port-80-on-Yahoo’s-webserver-the-packets-that-are-being-sent-back-and-forth-and-finally-the-closing-of-the-connection"><span class="toc-number">2.10.4.</span> <span class="toc-text">Identify the 3-way handshake that initiates the connection from your DNS server to port 80 on Yahoo’s webserver, the packets that are being sent back and forth and finally the closing of the connection.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Second-scenarios"><span class="toc-number">2.11.</span> <span class="toc-text">Second scenarios</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-tcpdump-and-telnet-on-client-the-same-step-as-first-scenarios"><span class="toc-number">2.11.1.</span> <span class="toc-text">Install tcpdump and telnet on client (the same step as first scenarios.)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Set-tcpdump-to-listen"><span class="toc-number">2.11.2.</span> <span class="toc-text">Set tcpdump to listen</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-telnet"><span class="toc-number">2.11.3.</span> <span class="toc-text">Run telnet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-tcpdump-referring-to-the-DNS-query-from-your-client-host-to-DNS-server"><span class="toc-number">2.11.4.</span> <span class="toc-text">Track down the packets in tcpdump referring to the DNS query from your client host to DNS server.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Track-down-the-packets-in-your-tcpdump-referring-to-the-DNS-query-from-your-DNS-server-to-one-of-the-root-servers-then-to-the-various-DNS-servers-before-the-DNS-information-is-returned-to-your-server-by-one-of-Tumblr’s-authoritative-DNS-servers"><span class="toc-number">2.11.5.</span> <span class="toc-text">Track down the packets in your tcpdump referring to the DNS query from your DNS server to one of the root servers, then to the various DNS servers before the DNS information is returned to your server by one of Tumblr’s authoritative DNS servers.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Third-scenarios"><span class="toc-number">2.12.</span> <span class="toc-text">Third scenarios</span></a></li></ol></li></ol>
</div>
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
</style>

<input type="button" id="tocButton" value="Hide"  title="Show or Hide Table of Contents">

<script>
    yiliaConfig.toc = ["Hide", "Show", !!"false"];
</script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"Tcpdump(1) DNS　| Ankai Liang's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2017/08/16/tcpdump-1-DNS/" data-title="Tcpdump(1) DNS" data-url="https://AnkaiLiang.github.io/2017/08/16/tcpdump-1-DNS/"></div>
    <script>
        var duoshuoQuery = {short_name:"ankailiang"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2017/08/17/afewmore-A-tool-of-ec2-how-to-write-a-shell-tool/" title="Pre: Afewmore">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="Mini Archives"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2017/08/16/Using-Manages-packages-in-Linux/" title="Next: Using Manages Packages in Linux">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/Text-processing-in-Linux/">Text-Processing</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/afewmore-A-tool-of-ec2-how-to-write-a-shell-tool/">Afewmore</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/tcpdump-1-DNS/">Tcpdump(1) DNS</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/Using-Manages-packages-in-Linux/">Using Manages Packages in Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/Using-the-AWS-CLI-to-set-instance/">Using the AWS-CLI to Set Instance</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/19/Install and Configure AWS Tools/">Install and Configure AWS Tools</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 Ankai Liang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="A fast, simple &amp; powerful blog framework">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="Another simple and elegant theme for Hexo  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >Site Visitors: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">Page Hits: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="Back to Top"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="Comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="Go to Bottom"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>